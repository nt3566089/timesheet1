## プリント時刻指定制限・手動プリント制限

###### 概要

1.  プリントを禁止したい時刻を設定する事により、その指定された時間内のプリントを制限する(印刷をしない)事が出来る。(プリント時刻指定制限と呼ぶ)

2.  また、メニュー画面上に配置された「プリント禁止ボタン」を押すことにより、プリントを制限する(印刷をしない)事も出来る。(CH12271。手動プリント制限と呼ぶ)
時刻によるプリント禁止と手動によるプリント禁止は同時に設定することができる。
本章では、以下について記述する

-   時刻指定制限中のジョブの表示・強制的な印刷指示方法

-   手動プリント制限ボタンの動作

-   手動プリント制限中のジョブの表示・強制的な印刷指示方法

尚、プリント時刻指定制限の設定方法はToolsCommon-Timerの項参照のこと。
手動プリント制限の設定方法はToolsCommon-Timer
及びToolsCommon-画面設定>補助機能選択の項を参照のこと。

その他、基本的な動作については、「FF 2-16 プリント時刻指定制限」参照の事。

正確なボタン名称・ボタン配置などについてはダイアログ仕様書参照の事。

###### 関連するDFD

|章|項目名|概要|
|---|---|---|---|
|16.3.02|Tools –仕様設定Common|プリント禁止時刻の設定、手動プリント制限の設定|
|07.2.1.1|Tools –仕様設定画面の設定|手動プリント制限ボタンの配置|
|08.4.1|Job - 未完了ジョブ表示内容一覧|プリントが禁止されている状態表示|
|08.3|Job – RunFrame|プリントが禁止されている状態表示と手動プリント操作|
||||


プリント禁止制限に関する動作については、本DFDが優先される。

### プリント時刻指定制限 の動作

時刻指定制限中のジョブの表示・強制的な印刷指示方法について記述する。

###### はじめに

-   Toolsで設定した禁止時間帯、開始時刻～終了時刻までを「禁止時間帯1」と記す。

-   禁止時間帯1を過ぎても、あるトリガ\*1があるまではプリント禁止状態を保持する(理由はFFにある土曜日/日曜日に自動プリントしない主旨の説明参照)。この、禁止時間帯1～あるトリガ\*1までの間を「禁止時間帯2」と記す。

-   上記、禁止時間帯1、禁止時間帯2は、本章のみの仮名である。また、\*1:あるトリガとはユーザーの操作(正確にはパネルからのプリント許可)を指す。

-   (補足)禁止時間帯1、2はそれぞれ、Device状態の(PrintInhibition::Enable(=禁止状態)/
    WaitingForOperation)と同じである。

###### プリント時刻指定制限の動作例  21:00～07:00まで禁止

|時刻|今の状態/Action|プリント受信で印刷するか?|システムの<br/>プリント制限状態<br/>|プリント許可通知|備考|
|---|---|---|---|---|---|---|
|2030とか|今はプリント許可時間帯|する|Disable(許可状態)|-||
|～2059|プリント受信したらプリントする|↑|Disable|-||
|2100|プリント開始時刻になった|しない|Enable(禁止状態)|-|禁止時間帯1|
|～|プリント受信してもプリントせず停留する|↑|Enable|-|禁止時間帯1|
|2200<br/>→10秒後<br/>|ここで、停留していたジョブを選択して手動でプリント開始操作を行うと<br/>→10秒後(プリント許可タイマタイムアップ後)、指示したジョブのプリントが始まる<br/>|↑|Enable|禁止<br/>10秒後許可<br/>|禁止時間帯1|
|0659||↑|Enable|-|禁止時間帯1|
|0700|ユーザー操作待ち状態|↑|WaitingForOperation|-|禁止時間帯2|
|～|プリント受信してもプリントせず停留する|↑|WaitingForOperation|-|禁止時間帯2|
|0830|ここでユーザー操作すると|↑|WaitingForOperation|禁止|禁止時間帯2|
|10秒後|10秒後に停留ジョブのプリントが始まる|開始する|Disable|許可||


###### ジョブの表示・強制的な印刷指示方法
(1)プリント禁止時間帯1の動作
(1-1)ジョブ状態確認画面(未完了ジョブ表示)について
1-1-1:画面全体に関わる表示

-   ジョブ状態確認画面に、「プリント禁止中」である主旨メッセージを表示する。但し、ジョブが1つもない場合、通常のメッセージを表示する。(積極的に禁止時間を言う必要はなく、文書があるのに何故プリントしないのかがわかる程度でよいとの判断から)

-   ジョブにはプリント禁止対象ジョブ・対象外ジョブがある(FF参照)。ジョブ状態確認画面に禁止対象外のジョブだけがある場合でも、「プリント禁止中」である主旨の表示を行う。(対象ジョブがあるときだけ表示するのが望ましいが、そこまで判別しなくてよいとの判断から)

-   「プリント開始ボタン」は、プリント時刻指定制限の影響を受けない。通常と同じ扱い。(よって、プリント開始ボタンを押してもプリント禁止制限を受けて停留しているジョブは出力されない。プリント禁止制限を受けて停留しているジョブを手動プリントするには2-3参照。
1-1-2:個々のジョブ関わる表示(各ジョブのラダー)

-   プリント禁止時間帯で停留しているジョブは、「プリント待ち」である主旨の表示を行う。
(1-2) プリント禁止時間帯1のRunFrame。

-   プリント禁止時間帯で停留しているジョブも通常ジョブと同じように、ジョブ状態確認画面からそのジョブを選択し、RunFrameを開く事が出来る。

-   この画面を開いた時、「優先」ボタンを押す事で手動プリントできる主旨のメッセージを表示する。
(1-3) プリント禁止時間帯1のジョブを手動でプリントする。

-   プリント禁止時間帯で停留しているジョブは、ジョブ状態確認画面からそのジョブを選択し、「優先ボタン」を押す事によりプリントすることが出来る。

-   

1.  プリント禁止時間帯2の動作

    -   プリント禁止時間帯2の動作は、プリント禁止時間帯1と同じ。

    -   プリント禁止時間帯2では、パネルからプリント許可を送る事で、プリント禁止時間帯2状態が解除され(PrintInhibition=WaitingForOperation→Disable)、自動プリントが開始される。

    -   
(2-1)プリント許可について

-   UI BasicBehavior参照のこと。

###### システムデータ

-   なし。(Tools設定は別途参照)

-   

###### 機種固有情報

-   FCWとHBでは、プリント開始ボタンの状態に差異がある。BG73901参照。

-   FCWは初期化中のKey操作は無視する。(Appendix参照)

-   

###### 制限・注意事項/備考

-   -   

###### 参考資料

-   FF 2-16 プリント時刻指定制限

### 手動プリント制限 の動作

手動プリント制限ボタンの動作、手動プリント制限中のジョブの表示・強制的な印刷指示方法について記述する。

###### 手動プリント制限ボタンの動作

-   手動プリント制限ボタン は、Toolsの設定によりユーティリティーボタンとして配置する事ができる。詳細はTools/ダイアログ参照。

-   ユーティリティーに配置されていても、以下の条件では表示を行わない。
手動プリント制限 がシステムデータによって無効になっている時。

-   手動プリント制限ボタン は、1つのボタンで「禁止」「許可」の制御を行う。 この為、ボタン名称、ボタンの振る舞いを状態によって変える必要がある。  
    システムのプリント制御状態 を参照し、名称と振る舞いを変える。

|システムのプリント制限状態|手動プリント制限ボタン||
|---|---|---|---|
||表示するボタン名*|ボタンを押した時の振る舞い|
|Disable(許可状態)|プリント禁止|システムを、プリント禁止状態に移行させる|
|Enable(禁止状態), WaitingForOperation|プリント禁止解除|システムを、プリント許可状態に移行させる|


\*:正確な名称はダイアログ仕様書参照の事

-   手動によりプリント禁止/解除をおこなった際に、状態値変更に加えて、変更時の時刻を設定する。(CH18680)

###### 手動プリント制限の動作例  

プリント禁止時刻=設定なし

|時刻|今の状態/Action|プリント受信で印刷するか?|システムの<br/>プリント制限状態<br/>|プリント許可通知|備考|
|---|---|---|---|---|---|---|
||今はプリント許可状態|する|Disable(許可状態)|-||
||手動プリント制限ボタンで「プリント禁止」にする|しない|Enable(禁止状態)|-||
||ここでプリント受信してもプリントせず停留する|↑|Enable|-||
|→10秒後|ここで、停留していたジョブを選択して手動でプリント開始操作を行うと<br/>→10秒後(プリント許可タイマタイムアップ後)、指示したジョブのプリントが始まる<br/>|↑|Enable|禁止<br/>10秒後許可<br/>||
|→10秒後|手動プリント制限ボタンで「プリント禁止解除」する<br/>→10秒後(プリント許可タイマタイムアップ後)、停留ジョブのプリントが始まる<br/>|する|Disable|禁止<br/>10秒後許可<br/>||


###### ジョブの表示・強制的な印刷指示方法
(1) 手動プリント制限中の動作
(1-1)ジョブ状態確認画面(未完了ジョブ表示)について
1-1-1:画面全体に関わる表示

-   プリント時刻指定制限と同じ。
2-1-2:個々のジョブ関わる表示(各ジョブのラダー)

-   プリント時刻指定制限と同じ。
(1-2) 手動プリント制限中のRunFrame。

-   プリント時刻指定制限と同じ。
(1-3) 手動プリント制限中のジョブを手動でプリントする。

-   プリント時刻指定制限と同じ。

###### システムデータ

-   なし。(Tools設定は別途参照)

-   

###### 機種固有情報

-   

###### 制限・注意事項/備考

-   

###### 参考資料

-   FF 2-16 プリント時刻指定制限

-   CH12271:手動プリント制限

-   CH18680:プリント禁止時間帯/手動によるプリント禁止のファクスサービス制限

### プリント時刻指定制限 と 手動プリント制限 同時に設定されている時の動作

プリント時刻指定制限 と 手動プリント制限は同時に設定する事ができる。

この場合、以下の何れかの条件を満たした場合、プリント禁止状態となる。

-   プリント禁止時刻となった      または

-   プリント禁止ボタンを押下した

また、プリント禁止状態中に以下の何れかの条件を満たした場合、はプリント禁止を解除する

-   プリント禁止終了時刻となった または

-   プリント禁止解除ボタンを押下した

UIはシステムから通知されるプリント制限状態に従って、ボタンの表示/受け付け(前途しているボタンを押した時の振る舞い)を行っていれば良く、同時に設定されたからといって、特別な意識する必要は無い。

### Appendix

# 本項では、質疑・背景等を記載します。
――――――――――――――――――――――――――――

1.  Q:プリント禁止時間帯1、2において、プリント禁止対象ジョブを停留させるのにパネルは何か影響するのか?

2.  A:特になし。Toolsでの時刻設定のみ。
――――――――――――――――――――――――――――

1.  Q:プリント禁止時間帯1において、プリント開始ボタンを押してもプリントが始まらない理由は?

2.  A:ジョブを選択して優先ボタンを押す事でプリント動作に入る為です。要求としても特に指示かありませんでしたのでプリント開始ボタンは既存動作のままとしました。また、プリント禁止時間帯1において、プリント禁止対象外のジョブがプリント許可待ち状態であれば、プリント開始ボタンを押す事でプリントは出力となります。
――――――――――――――――――――――――――――

1.  Q:FFに書かれる、「開始時刻の時既にプリント動作中であった場合には、そのジョブ(文書)のプリント動作の完了をもって、プリント禁止状態に移行する。」という状態でジョブ確認画面を表示した場合、「プリント禁止時間」である主旨メッセージを表示するのか? それともプリントが終わってから?

2.  A:開始時刻になった時に「プリント禁止時間」である主旨メッセージを表示します。これは、ジョブとは別にデバイスの状態としてプリント禁止時間帯であると通知があり、ジョブ状態画面ではデバイスの状態がどうかを参照している為です。
――――――――――――――――――――――――――――

1.  Q:FFでは、プリント禁止時間帯2の動作の解除はユーザー操作(の何らかのキーオペレーション等々..
    特記付き)としています。FFではユーザー操作なのですが、どうしてではDFDプリント許可なのですか?

2.  A:実装仕様です。
    プリント禁止時間帯2の状態でユーザー操作しても、ユーザー操作と同時にプリント許可=禁止を送ります。ということは、プリント禁止時間帯2の状態でユーザー操作してもすぐには出力されません。プリントが開始されるのはプリント許可タイマがタイムアップした時になります。その様な事もあり、システム設計の際プリント許可で制御することとした。
――――――――――――――――――――――――――――

1.  Q:プリント許可になっている状態で、プリント禁止時間帯2(PrintInhibition=WaitingForOperation)に移行した場合
    、プリントが開始されるのではないか?

2.  A:開始しないようです。(コントローラの制御なので書くべきではないので詳細は省きますが、あくまでプリント禁止時間帯2でプリント許可を受けた時に、停留ジョブをプリント起動するようです)
――――――――――――――――――――――――――――

1.  Q:ということは、プリント禁止時間帯2になる直前にユーザー操作を実施し、プリント許可タイマがタイムアップする前に、プリント禁止時間帯2に突入した場合プリントが始まるのではないか?

2.  A:始まりますが、例外処理と考えます。またこのケースは実際にユーザーがいるのかいないのかSOFTでは判断できません。
――――――――――――――――――――――――――――

1.  Q:FFには、「着信等によるスリープあるいはローパワー解除だけでは、受信文書のプリントの開始は行わない。その後にユーザー操作を実施された時に、プリント禁止期間か否かを判定し受信プリントの開始するかどうか、を判断する。」とありますが、実現方法の概要を教えてください。

2.  A:節電抜けはプリント許可を送りません。CH10939、BG74121も参考にして下さい。
――――――――――――――――――――――――――――

1.  Q:FFには、プリント禁止時間帯2で、「電源SWONした場合はプリントを開始する」という内容がありますが、実現方法の概要を教えてください。

2.  A:電源ON(ColdBoot)の場合は、プリント許可を送りますので、プリントが開始されます。Reboot/WarmBootで立ち上がる場合はプリント許可を送りませんので、ユーザー操作→プリント許可タイマ起動→タイムアップしてプリント許可通知 までは、プリントが開始しないということになります。
――――――――――――――――――――――――――――

1.  Q:プリント禁止時間帯2で、プリント許可タイマの設定が0の場合どうなりますか?

2.  A:すぐプリントが出力されます。CH10939、BG74121も参考にして下さい
――――――――――――――――――――――――――――

1.  Q:プリント禁止時間帯2で、プリント許可タイマの設定が0の場合、プリント禁止→プリント許可と送らなければならない理由は?

2.  A:システム実装仕様です。 プリント許可タイマの設定が0の場合、立ち上がり後、Panelからプリント許可を送ります。そうするとRscはずっとプリント許可状態なので、Panelからプリント禁止時間帯2でプリント許可のみを通知しても、Rscは変わりません。JobConは、Rsc変化通知をトリガにして、WaitingForUserOperation→Disableにすることを想定しています。従って
    一旦プリント禁止を通知して、再度プリント許可と送らなければなりません。
――――――――――――――――――――――――――――

1.  Q:FCWが初期化中のKeyEventを無視する理由は?

2.  A:実装仕様です。Yupaのようにコンパネ上に短縮本のフリップボタン(何ページ目か解る仕組みに使われるボタン)についてですが、節電復帰時にページによりフリップボタンがONの場合がある。この場合、立ち上げ途中、EWBからKey操作中Eventが通知される。このイベントを拾うと、誰も居ないのにKeyEventを拾い、結果として、ユーザー操作がないのにプリントが実施される懸念がある。この対処として、初期化中のKeyEventは無視する。(立ち上がり途中にユーザー操作を実施したがプリントが実施されない....
    という懸念があるがプリント出力されるリスクよりは小さい。との判断)
――――――――――――――――――――――――――――

1.  Q:プリント禁止ボタンで、禁止状態にした後、電源OFFした場合、次に電源ONするとどうなりますか?前の状態は引き継ぎますか?

2.  A:いいえ。手動でプリント禁止にした事は忘れる仕様です。ですので、あとは禁止時刻制限の仕様に従います。
――――――――――――――――――――――――――――

1.  Q:今、手動でプリント禁止中状態だとします。この状態でプリント受信した場合、プリントは停留しますが、この後、手動で「プリント禁止解除」にしても、すぐに印刷が始まらないのはなぜですか?

2.  A:Q7と同じ理由になります。
――――――――――――――――――――――――――――

1.  Q:「ユーティリティーに配置されていても、以下の条件では表示を行わない。 →手動プリント制限 がシステムデータによって無効になっている時」 とありますが、具体的に無効な時とはどのような場合でしょうか?

2.  A:プリント禁止設定のシステムデータ(700466)で、手動プリントが有効になっていない場合を指します。注意していただきたいのは、プリント禁止時刻のみ有効(プリント禁止時刻=有効、手動プリント制限=無効) の場合は、無効になります。