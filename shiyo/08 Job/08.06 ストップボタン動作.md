## Stopボタン動作

[8.6. Stopボタン動作 1](#stopボタン動作)

[8.6.1. 基本動作 1](#基本動作)

[8.6.1.1. Stopボタン操作後の表示動作(FXテリトリ仕様)
1](#stopボタン操作後の表示動作fxテリトリ仕様)

[8.6.1.2. Stopボタン操作後の表示動作(MNテリトリ仕様)(RF945/RF1291)
1](#stopボタン操作後の表示動作mnテリトリ仕様RF945RF1291)

[8.6.1.2.1. Overview 1](#overview)

[8.6.1.2.2. Stop/Pause画面の動作 2](#stoppause画面の動作)

[8.6.1.2.3. PausedJobDeleteConfirm画面の動作
3](#pausedjobdeleteconfirm画面の動作)

###### 用語補足

- ストップポーズ画面 Stop/Pause画面 StopPause  =&gt;
RF945で導入

- PausedJobDeleteConfirm画面     PJDC   =&gt; RF1291で導入

※イメージをつかんでもらうために載せているだけですので正確にはダイアログ仕様書を参考にしてください。

- ハードストップキー、ストップキー   =&gt; コンパネ上に配置

- ソフトストップボタン、ストップボタン  =&gt; ラン画面上に配置

### 基本動作

###### 動作
ハードストップキー押下により、実行中のIIT/IOT占有ジョブに対して一時停止要求する。
ハードストップキー押下により、表示画面を切り替える。

###### 制限
音声ナビモードにおいて音声アプリ画面がフォアグラウンドにいる場合、ストップキーは受付NGとして画面はそのままとする。(CH18033)

#### Stopボタン操作後の表示動作(FXテリトリ仕様)

###### 基本動作

1. ユーザーのハードストップキー操作の後、以下の表示動作を行う。

-   ユーザー操作により停止したIIT/IOT占有ジョブ(本操作以前に停止していたジョブも含む)のRun画面表示。

-   ファクス送信中ジョブ、ファクス送信待ち中ジョブのRun画面表示(RF838)。

    2.
    上記Run画面表示の対象ジョブが複数ある場合はRun画面表示を行わず、実行中ジョブ一覧画面の先頭ページを表示する(RF838)。

    3.
    ストップキー操作が実行中ジョブ一覧画面で行われた場合は、上記Run画面表示の対象ジョブの個数に関わらずRun画面表示は行わなず、実行中ジョブ一覧画面の先頭ページを再表示する(RF838)。対象ジョブが1つでRun画面表示中の場合、既に先頭ページ表示中の場合には実行中一覧画面の先頭ページ表示動作は行わない(BG121413)。

    4.
    ジョブ一覧画面への画面遷移が禁止されている状況でのハードストップキー操作時は、対象ジョブ(ファクス送信待ち中ジョブを除く)のRun画面表示を行う。

#### Stopボタン操作後の表示動作(MNテリトリ仕様)(RF945/RF1291)

##### Overview
**<概要>**

1.  ユーザーのハードストップキー指示によりIIT/IOT占有ジョブが一時停止(Pause)したとき、それらのジョブを「Stop/Pause画面」に表示する。(RF945)。

2.  ユーザーのソフトストップボタン指示によりIIT/IOT占有ジョブが一時停止(Pause)したとき、そのジョブを中止するかを確認する「PausedJobDeleteConfirm画面」を表示する。(RF1291)
    > 。

本仕様はPGS1002SGPからのPGS2014SGP要求に基づくものである。

-   (備考)
    RF1291導入により、ハードストップキーはStop/Pause画面、ソフトストップボタンはPausedJobDeleteConfirm画面となりました。RF1291導入以前はどちらの停止要因でもStop/Pause画面を表示する仕様。 RF945
    = DMP6以降導入。RF1291 = DMP 2007-1より導入。
**<基本動作>**

1.  ユーザーがハードストップキーを押下すると、IIT/IOTを使っているジョブを一時停止(Paused)状態にする。(DMP5以前からの仕様)
現在表示中の画面はどこであっても、通常モードならばストップキー押下で同様の動作となる[1]。また、一時停止対象となるジョブ種別は問わない。(Copyジョブであっても、ScanToXXジョブであっても、Fax受信プリントであってもレポートであっても、IIT/IOTリソースを専有するジョブならば何でも良い)
 

1.  IIT/IOT使用中ジョブのRun画面上に配置された\[ストップ\]ボタンをユーザーが押下すると、Run画面で表示されているジョブを一時停止する。(DMP5以前からの仕様)

2.   ユーザー操作により一時停止されたIIT/IOT占有ジョブのステイタスは、Paused、ReasonがByUserPausingの状態になる。このジョブをStop/Pause画面またはPausedJobDeleteConfirm画面に表示する。

|**ジョブ停止の起因**|**StopPause画面**|**PJDC画面**|
|---|---|---|---|
|ストップキー|表示する|表示しない|
|ストップボタン|表示しない|表示する|


StopPause画面:ストップキーでは複数ジョブに対してPauseをかけるが、同時に表示可能な最大ジョブ数は、IIT専有ジョブ1ジョブ+IOT専有ジョブ1ジョブである。コンティニュアル・プリント時にハードストップキーを押下すると、現在Processing状態にある全てのIOT専有ジョブが一時停止するが、Stop/Pause画面ではその中のジョブ1つのみを表示する[2]。

ストップキー押下後ストップボタンを押すケース、あるいはその反対にストップボタン押下後にストップキーを押すケースが考えられる。

どちらが先に押されていても基本的にMCが停止するまで次の受付を禁止しているはずなので、先に押された方が起因となると考えてよい。

1.  テリトリ情報システムデータに連動して、Stop/Pause画面の表示・非表示が次のように切り替わる。

|**システムデータの値**|**Stop/Pause画面**|
|---|---|---|
|FX|表示しない|
|PGS1002SGP|表示する|
|PGS2002SGP|表示する|
|AP|表示しない|


**<システムデータ>**

|**項目**|**意味**|**パラメータ/備考**|
|---|---|---|---|
|テリトリ情報|M/Cの出荷先テリトリを指定|FX/PGS1002SGP/PGS2002SGP/AP|

**<機種固有情報>**

-   RF945は、DMP6以降の全てのMNプロダクトで導入される。(HB/FCWとも)

-   RF1291は、DMP
    2007-1以降の全てのMNプロダクトで導入される。(HB/FCWとも)
**<制限・注意事項/備考>**
 なし。
**<参考資料>**

##### Stop/Pause画面の動作

###### 概要

ここでは、Stop/Pause画面の動作について説明する。
**<動作の説明&gt;**

1.  次の事象が発生した場合、Stop/Pause画面の生成を行う[3]。

    1.  Stop/Pause画面がどのパスにも存在しない状態で、IIT/IOTを占有しているジョブがPaused(ByUserPausing[4])状態に遷移したとき。

    2.  他のパスにStop/Pause画面が存在しているとき(現在居るパスでは画面未表示のとき)に、IIT/IOTを占有しているジョブが、Paused(ByUserPausing)状態に遷移したとき。

2.  次のいずれかが発生した場合、Stop/Pause画面の表示の更新を行う。

    1.  Stop/Pause画面表示中に、IIT/IOTを占有しているジョブが、Paused (ByUserPausing[5])状態に遷移したとき。

    2.  Stop/Pause画面表示中のジョブの状態がPaused(ByUserPausing)以外に遷移したとき。

3.   2.Stop/Pause画面の消去条件は次の通り。

    1.  ジョブの状態遷移が発生し、Stop/Pause画面に表示すべきジョブが存在しなくなった場合。

    2.  後述する、Stop/Pause画面を消去する操作・事象が発生した場合。
 

-   何らかの理由によりResumeRequest・CancelRequestの結果がResult=NGであった場合であっても、Stop/Pause画面は消去せずに、インバリッド音を鳴動するのみとする。(**TBD**。課題が無いことを確認中)

1.  Stop/Pause画面のBehavior上の取り扱いは、Run画面と同等にする。各種タイマーとの関係(起動条件等)も、Run画面との関係と同様とする。

2.  ジョブ種別等の画面内の表示文言は、ジョブ状態確認画面に準じる。また、コピージョブを一時停止させた場合の表示は、次のようになる。

    1.  IITのみ占有している場合は、IIT占有ジョブとして表示する。

    2.  IIT・IOT双方を占有している場合は、IIT・IOT占有ジョブとして表示する。このとき、他のIOT占有ジョブ(コンティニュアルプリントの他のジョブ)の表示は行わない。

    3.  IOTのみ占有している場合は、IOT占有ジョブとして表示する。このとき、他のIOT占有ジョブ(コンティニュアルプリントの他のジョブ)の表示は行わない。

3.   Stop/Pause画面表示中のユーザー操作の取り扱いを次表に示す。

|**ユーザー操作**|**具体的なオペレーション**|**M/C動作**|
|---|---|---|---|
|表示されたIITジョブのCancel(=ジョブの中断=Abort)|Stop/Pause画面上のScanning側の[Cancel]ボタンを押下する。|<ul><li>キャンセル操作されたジョブのみがAbortされる。<br/></li><li>それ以外のストップキー操作により止められたPaused(ByUserPausing)状態の一時停止中ジョブは、全て1自動的に即座にResumeする。<br/></li><li>Stop/Pause画面が閉じ、その前の画面に戻る。<br/></li></ul>|
|表示されたIOTジョブのCancel|Stop/Pause画面上のPrinting側の[Cancel]ボタンを押下する。|↑|
|表示されたIIT/IOTジョブ両方のCancel|Stop/Pause画面上の[Cancel Both]ボタンを押下する。|↑|
|表示されたIIT/IOTジョブ両方のResume|Stop/Pause画面上のScanning側の[Resume(Both)]ボタンを押下する。|<ul><li>ストップキー操作により止められたIIT/IOT専有中の全2ジョブがResumeする。<br/></li><li>Stop/Pause画面が閉じ、その前の画面に戻る。<br/></li></ul>|
|Resumeタイマがタイムアウトした場合|←|<ul><li>通常のResumeタイマタイムアウト動作を行う。すなわち、Resume対象の全ジョブがResumeされる。<br/></li></ul>|
|パスウェイキー押下|<ul><li>Job Statusキー押下<br/></li><li>Machine Statusキー押下<br/></li><li>Featureキー押下<br/></li></ul>|<ul><li>通常のパスウェイ動作を行う。(特に動作を抑制しない)<br/></li></ul>|
|スタートキー押下|←|インバリッド音で弾く。|
|ストップキー押下|←|通常のストップキー押下動作と同じ。(特に動作を抑制しない)|
|割り込みキー押下|←|通常の動作と同じ。(特に動作を抑制しない)|
|リセット(Clear All)キー押下|←|Run画面表示時と同じ動作となる。|
|節電(Power Saver)キー押下|←|通常の動作と同じ。(特に動作を抑制しない)|
|認証操作|<ul><li>暗証(Access)キー押下<br/></li><li>純正コピーカードを差し込む/抜く<br/></li><li>ICカードをかざす･認証解除ボタンを押下する<br/></li></ul>|通常の動作と同じ3。(特に動作を抑制しない)<br/>未認証状態から再度認証操作したときに、改めてStop/Pause画面をPopup表示することはない。<br/>|
|スペシャルキー押下|<ul><li>CE Mode Entry/Exitキー(&quot;0&quot;+Startキー)操作<br/></li><li>Fuser Assy寿命カウンタリセットキー(Reset+&quot;9&quot;キー)操作<br/></li></ul>|通常の動作と同じ。(特に動作を抑制しない)|
|モーダルキー押下|<ul><li>スタート(Start)キー押下<br/></li><li>テン(12)キー押下<br/></li><li>クリア(C)キー押下<br/></li><li>ポーズ(Dial Pause)キー押下<br/></li><li>短縮ダイヤル(Speed Dial)キー押下<br/></li><li>ワンタッチキー押下<br/></li></ul>|インバリッド音で弾く。|

<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>ソフトストップボタンが起因で停止したジョブは含まない(DMP2007-1追加)↩</p></li>
<li id="fn2"><p>同上↩</p></li>
<li id="fn3"><p>FCW/HBともに、認証キーは、Run画面･ジョブ状態確認画面でも有効である。これに則りStop/Pause画面でも認証キー押下は有効とする。↩</p></li>
</ol>
</section>
                            ※Stop/Pause画面には\[閉じる\]ボタンがないことに注意!

1.   Featureパス、もしくはMachine Statusパスにて
    Stop/Pause画面が表示されているときに、Job
    Statusパスに移動した場合について。その後のユーザー操作により、次のような画面遷移を行う。

|**ユーザー操作**|**M/C動作**|
|---|---|---|
|何もせずに元のパスに戻った場合|先に表示していたStop/Pause画面が表示される。(表示ジョブの状態変化がないため)|
|Stop/Pause画面で表示されていないジョブをAbortし、元のパスに戻った場合|↑|
|Stop/Pause画面で表示されていたジョブをAbortし、元のパスに戻った場合|<ul><li>Stop/Pause画面が最新の状態に更新されて表示される。<br/></li><li>残りの一時停止ジョブは、Resumeタイマー(Auto Clearタイマー)1にて、自動的に再開する。<br/></li></ul>|
|さらにStopキーを押したが、ジョブの状態に変化がなかった場合|ストップキーを弾く。(無効な操作であるため)|
|さらにStopキーを押したら、新たにIIT/IOTを専有しているジョブがPaused(ByUserPausing)状態になった場合|<ul><li>Stop/Pause画面が最新の状態で表示される。<br/></li></ul>|

<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Resume用のタイマーデフォルト値を30秒にせよ、との要求提示がPGS1002SGPよりあり →タイマのデフォルト値変更はプログラムレベルで検討することとした。↩</p></li>
</ol>
</section>

1.   Job
    Statusパス(=ジョブ状態確認画面が表示されている)においてStop/Pause画面が開いた場合について。この場合でも通常のパスウェイ動作に則り、Job
    Statusパスウェイキーをインバリッド音で弾く。
**<システムデータ>**
**  **なし
**<機種固有情報>**
なし
**<制限・注意事項/備考>**
 

-   Stop/Pause画面を表示することにより、ジョブ途中で出来ていた部数変更等の操作が容易に出来なくなる。
補足:

1.  部数変更に関しては、ジョブ状態画面からジョブを選択してラン画面を表示させれば変更できます。但しジョブ確認画面上でStop/Pause画面を表示した場合、(Stop/Pause画面を閉じる事が出来ないので)部数変更は出来ない。

2.  尚、ストップと同時に、次原稿待ち保留(ReasonとしてWaitingNextOriginalが通知される)やサンプルプリント確認保留(ReasonとしてWaitingProofConfirmが通知される)では、前ページのStop/Pause画面を表示する条件から外れます。

    -   
**<参考資料>**

##### PausedJobDeleteConfirm画面の動作
**<概要>**

ここでは、PausedJobDeleteConfirm(PJDCと記す)画面の動作について説明する。 
**<動作の説明&gt;**

1.  PJDC画面の表示条件は次の通り。
①ジョブ実行中にストップボタンが押下され、IIT/IOTを占有しているジョブがPaused(ByUserPausing\*1)状態に遷移したとき。
純粋にストップボタンで停止した場合がこれに該当し、ByUserPausing
+次原稿操作待ちや、ByUserPausing
+Jam等のFaultが起きた場合等は表示しません。

■実装情報:\*1生成条件をより正確に言うと、次のReasonを伴ったPaused状態に遷移したときである。

ByUserPausing

Decomposing&ByUserPausing

DecomposingIsPending & ByUserPausing

Formatting & ByUserPausing

Decompose系のReason、Formatting系のReasonはIOT動作一時停止になんら関係がない。従って、実装上は、Decompose系・Formatting系のReasonは無視する作りでよい。
2.PJDC画面の消去条件は次の通り。
①PJDC画面表示中に、ジョブの状態が遷移し、Paused(ByUserPausing\*1)以外の状態になった場合。

ジョブが自動的にキャンセルされた場合やジョブが自動的に継続された場合、また何らかの要因によって状態が変化した場合などがこれに該当します。

■実装情報:たとえばCopyPrintJobでPaused(ByUserPausing)ジョブが存在するときに、IotInterlockを開閉するとPJDC画面は消去される。 なぜならば、ジョブの状態遷移は、「Paused(ByUserPausing)」→「Paused(ByFail+ByUserPasing)」→「Paused(ByUserPausing+WaitingUserInstruction)」になる為。

同様に、Paused(ByUserPausing)ジョブが存在するときに割り込み突入→解除すると、PJDC画面は表示されないことになる。なぜならば、ジョブは、「Paused(ByUserPausing)」→「Processing」→「Interrupted」→「Processing」→「Paused(ByUserPausing)」と遷移し、Processingになった時点でPJDCでPausedしていた事を忘れるため。
②PJDC画面表示中に、PJDC画面を閉じる操作をしたとき
PJDC画面で、\[いいえ\]または\[はい\]を選択した場合がこれに該当します。

■実装情報:Q:\[はい\]はジョブキャンセルする(=すぐCancelledが通知される)のだから、\[いいえ\]だけで良いのではないか?

A: Cancelledがすぐ通知されないケースがあるので\[はい\]でも消します。

たとえばImageLog処理などでは後処理に時間がかかる場合があります。この場合、JobCancelReq～Res～Cancelledまでラン画面のステータスメッセージで「お待ちください」主旨のメッセージを表示しています。このようにCancelledがすぐ通知されないケースがあるので、\[はい\]でPJDCを消してラン画面でお待ちくださいを見せたほうがユーザーには親切です。
3.PJDC画面を閉じた後、再表示タイミングで再表示しない。
①PJDC画面表示中に、\[いいえ\]または\[はい\](PJDC画面を閉じる操作)が選択された場合、再表示タイミングでPJDC画面を表示しない。
たとえば、PJDC画面で\[いいえ\](PJDC画面を閉じる操作)を選択後、未完了ジョブ一覧画面からジョブを選択し再表示させた場合、PJDCは表示しない。逆にPJDC画面を閉じずに、未完了ジョブ一覧画面からジョブを選択し再表示させた場合、PJDCを表示する。

■実装情報:PrintJobなどDecomposing/Formattingを伴うジョブでは、
(ストップボタンでジョブ止めた時) a. State=Pasue +
Decomposing&ByUserPausing …..PJDC表示
(デコンポーズが終わると) b. State=Pasue + ByUserPausingのみに変化..
というIF通知が考えられる。もしaの後PJDCを閉じた場合、b.のタイミングで再度PJDCを表示しないつくりが望ましい。そうしないと、「あれっさっき\[いいえ\]を押したのにまた表示された!という動作になる為」。
4. PJDC画面表示中のユーザー操作の取り扱いを次表に示す。

|**ユーザー操作**|**具体的なオペレーション **|**M/C動作**|
|---|---|---|---|
|ジョブ中止操作|PJDC画面内の [はい] 中止に該当するボタンを押下する|キャンセル操作されたジョブのみがAbortされる。|
|ジョブ中止せずにPJDC閉じる|PJDC画面内の [いいえ] 閉じるに該当するボタンを押下する|ラン画面に戻る。|
|Resumeタイマがタイムアウトした場合|←|<ul><li>通常のResumeタイマタイムアウト動作を行う。すなわちジョブがResumeされPJDC画面は消える。<br/></li></ul>|
|パスウェイキー押下|<ul><li>Job Statusキー押下<br/></li><li>Machine Statusキー押下<br/></li><li>Featureキー押下<br/></li></ul>|<ul><li>通常の動作と同じ。(特に動作を抑制しない)<br/></li></ul>|
|スタートキー押下|←|インバリッド音で弾く。|
|ストップキー押下|←|通常のストップキー押下動作と同じ。(特に動作を抑制しない)|
|割り込みキー押下|←|通常の動作と同じ。(特に動作を抑制しない)|
|Cキー押下|←|インバリッド音で弾く。|
|リセット(Clear All)キー押下|←|インバリッド音で弾く。|
|節電(Power Saver)キー押下|←|通常の動作と同じ。(特に動作を抑制しない)|
|認証操作|<ul><li>暗証(Access)キー押下<br/></li><li>純正コピーカードを差し込む/抜く<br/></li><li>ICカードをかざす･認証解除ボタンを押下する<br/></li></ul>|通常の動作と同じ。(特に動作を抑制しない)|
|スペシャルキー押下|<ul><li>CE Mode Entry/Exitキー(&quot;0&quot;+Startキー)操作<br/></li><li>Fuser Assy寿命カウンタリセットキー(Reset+&quot;9&quot;キー)操作<br/></li></ul>|通常の動作と同じ。(特に動作を抑制しない)|
|モーダルキー押下|<ul><li>スタート(Start)キー押下<br/></li><li>テン(12)キー押下<br/></li><li>クリア(C)キー押下<br/></li><li>ポーズ(Dial Pause)キー押下<br/></li><li>短縮ダイヤル(Speed Dial)キー押下<br/></li><li>ワンタッチキー押下<br/></li></ul>|インバリッド音で弾く。|

                           
**<システムデータ>**
**  **なし
**<機種固有情報>**
なし
**<制限・注意事項/備考>**

-   CH12297でジョブ状態にミニポップが表示されジョブをポーズする手段が設けられるが、このボタンが押されてジョブがPauseした場合もPJDC画面を表示する。

-   PGS1002SGP-MNのMCパトリオットのDeleteConfirmとは仕様が異なる。例えば、パトリオットではコピー実行中に「Delete」を押すとサイクルダウンせずに\[PJDC\]画面が表示される(コピーは継続中)。この状態ではいを押すとジョブはいきなりDeleteされる。
    > (PGS2122SGPはこのDFDに書かれた仕様でよいとの事2006/11/21確認)
**<参考資料>**

-   CH12302

-   CH12297

[1] たとえRun画面を表示中であっても、Stopキー押下時の動作は同じ。

[2] どのジョブを表示させるかどうかは、よりSW設計がしやすい方法を採用すればよい。例えば「IOTキューの先頭のジョブ」「最も古く生成されたジョブ」「最初に一時停止状態に遷移したジョブ」など。。要求元のPGS1002SGP
PGS1298SGPでは、どれを表示するかの要求は提示されなかった。「過去のPGS1002SGP機にはコンティニュアルプリントがないこと」、「特にPGS1212SGPにおいては、コンティニュアルプリントが起きるのはレアなケースであること」がその理由である。

[3] 実装情報:SWのつくりとしては、JRMよりStateChangedEvent(Paused,ByUserPausing)を受信した時点で(=ジョブの状態がそのように遷移したとき)、Stop/Pause画面をポップアップさせるのが好ましい。ストップ押下によりポップアップしてしまうと、他のイベントや操作との関係が増えるため、検討項目が増えることが予想されるためである。

  この作り方をすると、次のようなことが起こる。

 =DMP2007-1より対象はハードストップキーのみとする。

(2007-1以前)。 Paused(ByUserPausing)ジョブが存在するときに割り込み突入→解除すると、Stop/Pause画面は表示されないことになる。なぜならば、ジョブは、「Paused(ByUserPausing)」→「Processing」→「Interrupted」→「Processing」→「Paused(ByUserPausing)」と遷移し、Processingになった時点でStopPauseで止まっていた事を忘れるため。

また、Stop/Pause画面表示中にオートクリアがかかった場合には、改めてStop/Pause画面は表示されない。なぜならば、それだけではジョブ状態遷移が発生しないからである(いずれResumeされるジョブがあるかもしれないが)。

[4] 実装情報:生成条件をより正確に言うと、次のReasonを伴ったPaused状態に遷移したときである。

ByUserPausing

Decomposing&ByUserPausing

DecomposingIsPending & ByUserPausing

Formatting & ByUserPausing

  Decompose系のReason,Formatting系のReasonはIOT動作一時停止になんら関係がない。従って、実装上は、Decompose系・Formatting系のReasonは無視する作りでよい。

[5] 脚注4参照のこと。更新の対象となるReasonも脚注4と同じ条件である。