## Web-Based EP

### Reference
共通プラットフォーム システム基本仕様書 Features&Functions編 3-02-10-4
Web-based EP\\K1.2.1(20071112)
対応RF979/CH13075

### WEP概要

#### WEP対応機能一覧
表18.3.2.1. WEP商品をサポートするために提供する機能一覧 (○:機能あり,△:機能あり(追加提供条件あり),-:なし)

|機能|概要|WEP未設置(*1)|WEP設置|対応ユーザ|
|---|---|---|---|---|---|
|設置|UIから設置依頼送信<br/>CE識別情報を送信<br/>設置結果(成功・エラー)の表示<br/>|○|○|KO(IBGのみ)/CE|
|撤収|UIからの撤収依頼送信<br/>撤収結果(成功・エラー)の表示<br/>|○|○|CE|
|リクエスト送信 (EP通信確立)|EP通信確認(手動ポーリング)の制御<br/>EP通信確認(手動ポーリング)の結果(成功・エラー)の表示<br/>|-|○|KO/CE|
|サービスパラメータ参照/設定|UIからの設定と全サービスパラメータの送信<br/>送信結果(成功・エラー)の表示<br/>|-|○|CE|
|デバイス認証(証明書削除)|UIからのEP証明書削除|○|○|CE|
|KOC (Key Operator Call)|UI(KO)からの修理依頼の通知<br/>サービスパラメータに応じた「修理依頼」ボタンの表示<br/>|-|△<br/>18.3.2.8参照<br/>|KO|
|診断データ送付依頼|UI(KO)からの診断データ送付依頼<br/>送信結果(成功・エラー)の表示<br/>サービスパラメータに応じた「EP診断」ボタンの表示<br/>|-|△<br/>18.3.2.9参照<br/>|KO|
|オンサイトデバイス診断機能|UI(CE)からの診断データ送付依頼<br/>CE識別情報を送信<br/>送信結果(成功・エラー)の表示<br/>サービスパラメータに応じた「EP診断」ボタンの表示<br/>|-|△<br/>18.3.2.10参照<br/>|CE|

**1:18.3.2.2 システム構成を参照**

#### システム構成
EPシステムの接続状態として、「WEP設置」が確認できるとき有効とする。
EPシステムの接続状態として未設置/PGS1103SGP設置/EP-DX設置/WEP設置が参照可能である。「WEP未設置(*1)」は未設置の状態を示す。「PGS1103SGP設置」もしくは「EP-DX設置」のケースではそれぞれのEPシステム構成の対応を実施する。

#### 設置
###### 概要
カスタマーエンジニア(CE)にて設置情報をEPシステムに登録する。
IBGテリトリにおいては、KOによる設置も可能。(CH20933)
###### 動作

-   設置は\[BB設置\]、\[EPA-Server設置\]の2種類が指定可能で、それぞれの設置種類で必要なパラメータの入力を可能とする。

-   \[BB設置\]は、本番環境とデモ環境への設置操作が可能。(デモ環境への設置は、CEによる設置時のみ可能)
    \*1

-   必須パラメータ入力が終了したら、EPシステムへ登録要求を行う。

-   以下のパラメータが未設定のときは、UIから登録要求は行わない。

    -   CEによるBB設置

        -   社員番号

    -   KOによるBB設置

        -   (設定できるパラメータはない)

    -   CEによるEPA-Server設置

        -   接続先アドレス

        -   社員番号

    -   KOによるEPA-Server設置

        -   接続先アドレス
- EPシステムへの情報登録の状態(成功もしくは失敗した)をユーザに通知する。失敗した場合は、失敗理由を通知する。
表18.3.2.3. 設置パラメータ一覧
「○」:設定可能、「△」:値の表示のみで設定不可、「-」:関係なし

||パラメータ|||||||
|---|---|---|---|---|---|---|---|---|
|設置種類|接続先アドレス<br/>|接続先パス<br/>|社員番号<br/>|プロキシサーバー<br/>|ポート番号<br/>|プロキシポート番号<br/>|概要|
|BB設置|○|○|○|△|-|-|インターネットを介して直接EPシステムと接続して、2nd Stepサービスを提供する機能<br />(本番環境への設置)|
|BB設置(デモ環境)|○|○|○|△|-|-|インターネットを介して直接EPシステムと接続して、2nd Stepサービスを提供する機能<br />(デモ環境への設置) *1|
|EPA-Server設置|○|○|○|-|○|○|EP-Serverを経由してEPシステムと接続して、2nd Stepサービスを提供する機能|

###### システムデータ

|項目|設定範囲|備考|
|---|---|---|---|
|接続先アドレス|ASCII文字列<br/>(NULL終端文字を含めて、128バイト)<br/>|BB設置では、設置状態によりそれぞれ以下のシステムデータの値を表示する。*1<br/>本番環境 設置済み:接続先保存用アドレス (C-L=920-003)<br />本番環境 未設置時:本番用接続先文字列アドレス (C-L=920-049)<br/>デモ環境 設置済み:接続先保存用アドレス (C-L=920-003)<br />デモ環境 未設置時:デモ用接続先文字列アドレス (C-L=920-051)<br/>|
|接続先パス|ASCII文字列<br/>(NULL終端文字を含めて、128バイト)<br/>|BB設置では、設置状態によりそれぞれ以下のシステムデータの値を表示する。*1<br/>本番環境 設置済み:接続先保存用パス (C-L=920-004)<br />本番環境 未設置時:本番用接続先文字列パス (C-L=920-050)<br/>デモ環境 設置済み:接続先保存用パス (C-L=920-004)<br />デモ環境 未設置時:デモ用接続先文字列パス (C-L=920-052)<br/>|
|コメント|ASCII文字列<br/>(NULL終端文字を含めて、13バイト)<br/>||
|ポート番号|0～65535||
|プロキシポート番号|0～65535||

###### 制限・注意事項/備考

-   設置要求は、設置状態にかかわらず(既に設置が終了している状態でも)指示可能とする(結果は失敗が通知される)。

-   BB設置時に表示するプロキシーサーバーは、「EPプロキシーサーバー」のアドレスを表示する。
- 
KOにより設置される場合、社員番号はKOユーザから入力させるのではなく、UIより固定の文字列を通知する。通知内容は別仕様書
(システム基本仕様書 FF編 3-02-10-4 WEP) 参照。
\*1 \[2008/06/26\] RF2881/CH15574
BB設置(デモ環境)への対応。

#### 撤収
###### 概要
WEPシステムが設置状態であるときに、カスタマーエンジニア(CE)にてデバイスからの登録解除(撤収)をEPシステムに通知する。
###### 動作
- EPシステムへ撤収要求を行う。
- EPシステムからの撤収の状態(成功もしくは失敗した)をユーザに通知する。失敗した場合は、失敗理由を通知する。
###### 制限・注意事項/備考

-   撤収要求は、設置状態にかかわらず(既に撤収されている状態でも)指示可能とする(結果は失敗が通知される)。

-   失敗理由は Fail Set(Chain-Link No.)
    として表示する。特別なメッセージは表示しない。

#### リクエスト送信 (EP通信確認)
###### 概要
デバイスから直接ポーリング操作を行うことで、EPシステムからのリクエストを実行する。
(通常、デバイスはユーザのファイアウォール環境内に設置されている。そのためEPシステムからデバイスに対して直接にリクエストを送信することはできない。このためEPシステムからのリクエスト送信は、デバイスが起点となるポーリングによって実現される。)
###### 動作
- EPシステムへ通信確認(手動ポーリング)要求を行う。
- EPシステムからの通信確認の状態(成功もしくは失敗した)をユーザに通知する。失敗した場合は、失敗理由を通知する。
###### 制限・注意事項/備考

-   デバイスは手動ポーリングによって得たリクエストに対応するレスポンスをEPシステムへ送信する。リクエスト取得/応答の期間はリクエストの内容にかかわらず、「通信を確認」の旨の通知をユーザに提供する。

-   失敗理由は Fail Set(Chain-Link No.)
    として表示する。特別なメッセージは表示しない。

#### サービスパラメータ参照/設定
###### 概要
CEがデバイスUIからサービスパラメータの現在状態の表示とサービスパラメータ変更時の設定要求を行う。
(サービスパラメータとは、EPサービスの動作を変更するパラメータでアプリケーションサービス毎に定義される。デバイスから設定変更を行った場合、その変更内容をEPシステムに通知して、デバイスとEPシステムの双方で管理しているサービスパラメータの整合性を保つ。)
###### 動作
- サービスパラメータの現在状態を取得して表示する。
- EPシステムへサービスパラメータ設定要求を行う。
- EPシステムからのパラメータ設定の状態(成功もしくは失敗した)をユーザに通知する。失敗した場合は、失敗理由を通知する。
###### システムデータ

|項目|設定範囲|備考|
|---|---|---|---|
|定期ポーリング時刻:時|0～23||
|定期ポーリング時刻:分|00～59||
|定期ポーリング周期|毎日|40<br/>|
||日、月、火、水、木、金、土|50～56<br/>|
||1～31|1～31<br/>|
||通知しない|0<br/>|
|現在ビリング定期通知周期|毎日|40<br/>|
||日、月、火、水、木、金、土|50～56<br/>|
||1～31|1～31<br/>|
||通知しない|0<br/>|
|ビリング締日|指定しない、1～31||
|ビリング締時刻:時|0～23||
|ビリング締時刻:分|00～59||
|締めビリングデータ通知日|指定しない、1～31||
|締めビリングデータ通知時刻:時|0～23||
|締めビリングデータ通知時刻:分|00～59||
|CRU Near Empty通知可否||デバイスの能力有無のため、パネルからの設定はない<br/>|
|CRU Near Full通知可否||デバイスの能力有無のため、パネルからの設定はない<br/>|
|CRU交換通知可否||デバイスの能力有無のため、パネルからの設定はない<br/>|
|CRU Near Empty通知フラグ|しない、する||
|CRU Near Full通知フラグ|しない、する||
|CRU 交換通知フラグ|しない、する||
|診断データ定期通知周期|毎日|40<br/>|
||日、月、火、水、木、金、土|50～56<br/>|
||1～31|1～31<br/>|
||通知しない|0<br/>|
|KOC可否|しない、する|修理依頼ボタンの表示有無フラグのこと<br/>|
|Alert発呼有無フラグ|しない、する||
|ERU Near Empty発呼有無フラグ|しない、する||
|診断ボタン(顧客用)表示有無フラグ|しない、する||
|診断ボタン(CE用)表示有無フラグ|しない、する||
|通知タイマー(原稿づまり)|しない(0)、10～255|CH14894、CH15209<br/>|
|通知タイマー(紙づまり)|しない(0)、10～255|CH14894、CH15209<br/>|
|通知タイマー(カバーオープン)|しない(0)、10～255|CH14894、CH15209<br/>|
|通知タイマー(オフライン)|しない(0)、10～255|CH14894、CH15209<br/>|
|消耗品配送予定日の表示|しない、する|CH14688<br/>|
|機能別カウンター通知フラグ|通知しない、通知する|CH14686<br/>|
|ソフトウェア更新ボタン表示(KO用)|無効、有効|CH16386<br/>|
|ソフトウェア更新ボタン表示(CE用)|無効、有効|CH16386<br/>|
|デバッグログ通知|無効、有効|CH19281<br/>|
|セカンド定期ポーリング時刻:時|0～23|CH23882<br/>|
|セカンド定期ポーリング時刻:分|00～59|CH23882<br/>|
|セカンド定期ポーリング周期|毎日|CH23882<br/>|
||1～31|(1～31の値は運用上使用されない)<br/>|
||通知しない||
|機器設定用コンフィグ情報通知フラグ|無効、有効|CH23882<br/>|
|日次本体集計カウンター通知時刻:時|0～23|CH23883<br/>|
|日次本体集計カウンター通知時刻:分|00～59|CH23883<br/>|
|日次本体集計カウンター通知フラグ|無効、有効|CH23883<br/>|
|締め本体集計カウンター通知フラグ|無効、有効|CH23883<br/>|
|機能別カウンター通知方式|従来方式(月次)、新方式(日次)|CH25639<br/>|
|機能別カウンター通知時刻:時|0～23|CH25639<br/>|
|機能別カウンター通知時刻:分|00～59|CH25639<br/>|

###### 制限・注意事項/備考
失敗理由は Fail Set(Chain-Link No.)
として表示する。特別なメッセージは表示しない。
080221 RF1991/CH14894
「<DMP-Y2a以降共通:EP-BB>プロアクティブセンタ対応」でサービスパラメータ(4つ)を追加する。コンフィグによる非表示切り替えは実施しない。
2008/06/02 CH15209
「<DMP-Y2a以降共通:EP-BB>プロアクティブセンタ対応関連サービスパラメータ名称変更(MFのみ)」で項目名称を変更する。  
###### 旧名称 ⇒ 新名称 Document Jam放置 ⇒ 通知タイマー(原稿づまり)  
Paper Jam放置 ⇒ 通知タイマー(紙づまり)  
Interlock Open放置 ⇒ 通知タイマー(カバーオープン)  
Offline放置 ⇒ 通知タイマー(オフライン)
2008/06/02 CH14688
「<DMP2008>RF2315:CRU/ERUの配送予定日をUI表示する」でサービスパラメータを追加する。  
2008/06/26 RF2880/CH15563
EPサービスパラメータ画面でのサービスパラメータの変更を禁止する。  
2008/06/26 RF2316/CH14686
デバイス稼動状況通知対応のためのサービスパラメータを追加する。
「機能別カウンター通知時刻」パラメータの内容は「機能別カウンター通知方式」が従来方式に設定されているときには意味をなさないが、表示は消さないこと。(CS部要求による。)

#### デバイス認証 - UIからのEP証明書削除
###### 概要
CEがデバイスUIからEP証明書の削除を要求する。
(EPシステムとのすべての通信に際して行われる、EPシステムによるデバイスの認証に使用する証明書)
###### 動作
- EPシステムへ証明書削除要求を行う。
- EPシステムからの削除の状態(成功もしくは失敗した)をユーザに通知する。失敗した場合は、失敗理由を通知する。
###### 制限・注意事項/備考
- EPシステム撤収後もEP証明書の削除は行うことができる。

#### KOC (Key Operator Call - KO修理依頼)
###### 概要
KOがデバイスUIから修理依頼を要求する。
###### 動作
- EPシステムへKOC(修理依頼)を要求する。
- EPシステムからの依頼の状態(成功もしくは失敗した)をユーザに通知する。失敗した場合は、失敗理由を通知する。
###### 制限・注意事項/備考
- サービスパラメータ「KOC可否」に「しない」が設定されているとき、デバイスUIからの「修理依頼」を提供しない。

#### 診断データ送付依頼 (KO診断依頼)
###### 概要
KOがデバイスUIから診断依頼を要求する。
###### 動作
- EPシステムへ診断依頼を要求する。
- EPシステムからの依頼の状態(成功もしくは失敗した)をユーザに通知する。失敗した場合は、失敗理由を通知する。
###### 制限・注意事項/備考

-   IOT診断データの通知が「可能」で、かつサービスパラメータ「診断ボタン(顧客用)表示有無フラグ」に「する」が設定されているとき、デバイスUIからの「診断依頼」を提供する。

-   失敗理由は Fail Set(Chain-Link No.)
    として表示する。特別なメッセージは表示しない。

#### オンサイトデバイス診断機能 (CE診断依頼)
###### 概要
CEがデバイスUIから診断依頼を要求する。
###### 動作
- CEの識別情報(会社コード、社員番号など)を入力する。
- EPシステムへ診断依頼を要求する。
- EPシステムからの依頼の状態(成功もしくは失敗した)をユーザに通知する。失敗した場合は、失敗理由を通知する。
###### 制限・注意事項/備考

-   IOT診断データの通知が「可能」で、かつサービスパラメータ「診断ボタン(CE用)表示有無フラグ」に「する」が設定されているとき、デバイスUIからの「診断依頼」を提供する。

-   失敗理由は Fail Set(Chain-Link No.)
    として表示する。特別なメッセージは表示しない。

#### リモート保守サービス(NVM Read/Write) (CH19280)
###### 概要
EPセンターからデバイスのNVM Read/Writeを実施する。
CEディスパッチを減らすことを目的としている。
###### 動作
EPセンターからのNVM Read:
UIの動作はない。
EPセンターからのNVM Write:
EPセンターとの通信により、M/CのHDD中にNVM打ち替えファイルが置かれ、NVM打ち替え予約状態となる。
実際のNVM打ち替えは次回のReboot 時に実施されるため、手動でのReboot
(Power OFF/ON) を促すためのステータスメッセージ表示を行う。
###### 注意事項/備考
表示するステータスメッセージについて、優先順位および消去条件は、LocalFail表示のステータスメッセージと同様とする。
(正式な文言、表示・消去タイミング、表示優先順位については、ダイアログ仕様書
12.01.06 ブロードキャストメッセージ 参照のこと)

#### エラーログの送信 (CH42537)
###### 概要
システムフェイル発生時にHDDに書き出されるエラーログを送信する。
###### 動作
以下の条件を全て満たすとき、システムデータ「EP-BB経由でデバッグログを送信する機能の設定」の切り替え手段(920-191)をToolsに提供する。
- システムデータ「EP-BB経由でデバッグログを送信する機能提供の有無」が「提供する」(920-190=1)
- EP設置済み
以下の条件を全て満たすとき、エラーログの送信手段を提供する。
- システムデータ「EP-BB経由でデバッグログを送信する機能の設定」が「有効」(920-191=1)
- システムデータ「EP-BB経由で送信するデバッグログの状態」が「有り」(920-192=1)
- EP設置済み
###### 注意事項/備考
- エラーログ送信の結果はガイドしない。
- エラーログ送信する/しない、また選択自体の有無、自動リセット、節電Entry/Exit、電源OFF/ONに関わらず、選択画面が閉じられたらそれを再表示しない。

###  4G/3Gnet-BOX概要
3Gnet-BOXはデバイスとUSB接続される3G(FOMA)通信アダプタであり、Web-based
EP(WEP)の「デバイスのLAN回線」を置き換えることができる。
3Gnet-BOX とEPサービス(FXドメイン)が3G (FOMA)
回線により接続される形態となる。
4Gnet-BOXはデバイスとUSB接続される4G(LTE)通信アダプタであり、Web-based
EP(WEP)の「デバイスのLAN回線」を置き換えることができる。
4Gnet-BOX とEPサービス(FXドメイン)が4G(LTE)あるいは3G (FOMA)
回線により接続される形態となる。  
4Gnet-BOXは3Gnet-BOXの生産終了(2017年)に伴って開発された後継機であり、3Gnet-BOX同等の機能を持つ。3Gnet-BOXの置き換えにも利用される。
RF11583(CH37512/CH37513)にてDMP-XI-56以降導入
RF6802(CH28099)にてDMP-XI-1d以降導入。
RF7605(CH27881)にてDMP-XI-1c-PL導入
RF7605(CH29304)にてDMP-XI-1a導入
RF7605(CH29801)にてDMP-X-PL3導入
RF7605(CH30449)にてDMP-2009-3a導入

#### 4G/3Gnet-BOX対応機能一覧
WEP対応機能のうち、4G/3Gnet-BOXにより「デバイスのLAN回線」を置き換えることができる機能を下記に示す。
- 設置
4G/3Gnet-BOXを接続したEPサービスの利用形態となるため、「診断」の対象・方法が異なるため、下記の機能が新設される。
- 通信診断レポート

#### システム構成
3Gnet-BOXの搭載機(PDI)であるとき、4G/3Gnet-BOXの接続を有効とする。
###### PDI
PDI(COML\_PDI\_3GNETBOX\_AVAILABLE)が "1"の時

#### 設置
ここでは「18.3.2.3 設置」との違いを記述する。
###### 概要
FXテリトリのみ設置できる。
###### 動作
-  \[BB設置\]において、4G/3Gnet-BOXを選択することができる。
- デモ環境の設置操作を提供する(CH37512)
- 4G/3Gnet-BOXを選択した場合、「プロキシーサーバー」パラメータの提示を行なわない。

#### 通信診断レポート
###### 概要
4G/3Gnet-BOXの接続、4G/3Gnet-BOXを用いたEPサービス(FXドメイン)接続を診断する。
診断結果レポートを出力する
###### 動作
- EPシステムへ通信診断レポート依頼を行なう。
- 診断の対象
 「4G/3Gnet-BOXへの接続」と「4G/3Gnet-BOXを用いたEPサービスへの接続」の二つがある。
- 実行前に診断時間(最大値)をユーザへ提示し、確認の上で実行する。
 このとき提示する診断時間(最大値)は、「4G/3Gnet-BOXへの接続」と「4G/3Gnet-BOXを用いたEPサービスへの接続」を所定のリトライ回数行なう時間の総和となる。(※3)
 通信診断実行中には、実行段階に応じて下記の2種類の診断時間(最大値)を提示する。
  1)
「4G/3Gnet-BOXへの接続」および「4G/3Gnet-BOXを用いたEPサービスへの接続」の診断がいずれも行なえていない場合
「4G/3Gnet-BOXへの接続」の診断時間(※1)と「4G/3Gnet-BOXを用いたEPサービスへの接続」の診断時間(※2)の総和を計算する。  
(※1) + (※2) ) …(※3)  
  2)
「4G/3Gnet-BOXへの接続」がOKとなり、「4G/3Gnet-BOXを用いたEPサービスへの接続」の診断を行なっている場合  
「4G/3Gnet-BOXを用いたEPサービスへの接続」の診断時間(※2)を計算する。  
(※2)  
 通信診断後、通信診断レポート出力中であることを示す。  
 所定のレポートジョブが終了した場合、「通信診断レポート出力中であることを示す」画面を閉じる。
(※1) 「4G/3Gnet-BOXへの接続」の診断時間  
(「3GNetBoxのUSB接続のタイムアウト時間(秒)」+「3GNetBoxとのコネクション確立時のタイムアウト時間(秒)」)X(1+「短周期リトライ回数」)
/ 60  
(※2) 「EPサービスへの接続」診断時間(「証明書取得通信」時間を含む)  
(( 30 +「データ転送タイムアウト時間設定」+ 30 )× ( 1 +
「短周期リトライ回数」) / 60
###### システムデータ

|項目|設定範囲|備考|
|---|---|---|---|
|3GNetBoxのUSB接続のタイムアウト時間(秒)|0～4294967295|CH28099<br/>CH27881(DMP-XI-1c-PL)<br/>CH29304(DMP-XI-1a)<br/>CH29801(DMP-X-PL3)<br/>|
|3GNetBoxとのコネクション確立時のタイムアウト時間(秒)|0～4294967295|CH28099<br/>CH27881(DMP-XI-1c-PL)<br/>CH29304(DMP-XI-1a)<br/>CH29801(DMP-X-PL3)<br/>|
|データ転送タイムアウト時間設定|1～600|CH28099<br/>CH27881(DMP-XI-1c-PL)<br/>CH29304(DMP-XI-1a)<br/>CH29801(DMP-X-PL3)<br/>|
|短周期リトライ回数|0～255|CH28099<br/>CH27881(DMP-XI-1c-PL)<br/>CH29304(DMP-XI-1a)<br/>CH29801(DMP-X-PL3)<br/>|
