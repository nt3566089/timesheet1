##  パージ表示
マシン内から、原稿/用紙除去の手間を少なくし、リカバリー性を高めるための動作(=パージ)について記述する。

[20.1 パージ表示 1](#パージ表示)

[20.1.1. 概要 2](#概要)

[20.1.2. IIT(原稿)パージ動作 2](#iit原稿パージ動作)

[20.1.3. IOTダウンパージ動作(CH12910)
3](#iotダウンパージ動作CH12910)

[20.1.4. IOTアップパージ動作(CH24088)
4](#iotアップパージ動作CH24088)

[20.1.5. タブ紙Jam解除後のIOTパージ動作(RF3802/CH19322)
4](#タブ紙jam解除後のiotパージ動作RF3802CH19322)

[APPENDIX 6](#appendix)

**<上位仕様と本章>**

■FF 

3.2.30 IIT/IOT Device Management参照のこと

■Concept and Basic Behavior 、UI Dialogue

UI Dialogue 11.05.03.14 ダウンパージ

■関連するUI-DFD

|UI-DFD|関連する内容|
|---|---|---|
|20章 Fault&amp;Recovery|Fault&amp;Recovery全般|


**< エラーの通知について >**
それぞれのエラーの状態はUIに通知される。UIでは、通知に対応した表示をおこなう。
種類については、各種検討会で決定される。

$

### 概要

###### 概要

1. 原稿除去(IITパージ)はTBD。

2. IOT側のパージ制御は、IOT-SOFT側で行われる。UIで行うことは、ダウンパージ通知を受けた時に、「パージ排出したので用紙を取りのぞけ」主旨の画面を表示する。

また、アップパージ通知を受けた時は、「アップパージ中」主旨の画面を表示する。

###### 用語

IOTダウンパージ: MC動作中にジャム等を検出し、MCが停止するまでの間に排出先を変更して用紙を機内の残さないようする動作。

IOTアップパージ:
MC停止状態から、MC内ある用紙を排出する動作。ジャム原因紙はユーザーに除去させるが、その他の用紙はジョブ起動やジョブ継続時に排出する動作。

### IIT(原稿)パージ動作

IIT側が必要に応じてパージ動作を行う。パージ動作期間も短い為UI側でこの表示は特に用意しない。

### IOTダウンパージ動作(CH12910)

###### 基本動作

1.
プリント中ジャム等を検出したとき、ペーパーパス上にある用紙を排出できる排出先に排出する。

   紙送りの制御はIOT/Controllerの仕様に従う。

2. ペーパーパス上に乗っている用紙の排出を終えるとMCは停止する。

3.
ジャム検出～パージ動作～MC停止までの期間は、特にMCの動作を表すメッセージ等の表示は行わない。

4.
MC停止後、「パージ紙排出したので用紙を取りのぞけ」旨の画面を表示する。パージ確認画面はJAMより優先して表示する。

5. 確認ボタンまたはIOTプリント動作開始で上記画面を閉じる。

6. FAIL等によりジョブ終了と同時に起きるケースもある。

※上記画面は、どのようなオブジェクトを制御するのかを参考として載せている程度ですので、画面の正しい配置・文言等はダイアログ仕様書参考の事。

**<動作仕様>**

■フレーム制御
1. ダウンパージ通知を受けた時に、「パージ排出したので用紙を取りのぞけ」主旨の画面を表示する。
2. ダウンパージ確認画面内にある確認ボタンを押すことでパージ画面を閉じる。
参考情報…

パージ紙が取り除かれたか否かをMCは知る手段がありません。

ですので、JRMからパージクリアの通知もありません。

パージ確認待ち中・パージ確認待ち クリアは、パネル自身で管理します。

DMP-XIより、パージ確認押下をCont側に通知するよう変更。これによりCont側(IOT)では、エラー状態を解除する。この動作が必須なのはPGS1253SGP-IOTであるが、プロダクト共通で確認押下通知を行い、IOTまで通知するか否かはCont側で吸収する。

UIは、確認結果のOK/NGに関わらず画面を閉じる(NGが返るのはバグの時)。
3. 
パージ画面の確認ボタンを押さずにジャムリカバリするケースが考えられる。この場合、ジャムクリア後MCは自動的にプリントを再開するケースがある。自動的にプリントが再開された場合、パージ確認画面を消す。
参考情報…

パージ確認待ち中にIOTState=Printingを受けたとき、UIは画面を消去すると共にパージ確認待ち中をクリアする。

PGS1253SGPでは、確認ボタンが押されるまで画面を維持する必要がある。よって本来は、この(3.の)仕様は対象外にすべき。しかし、DeviceErrorになっているので確認押下操作をしない限りPrintingStateに遷移しないとこのとでしたので、共通仕様としてこのまま残す。IOT/IOTscとの検討会で確認した。
4. ダウンパージ画面の確認ボタンを押さずに別の画面に遷移した場合、次のタイミングで再表示する。
    ・オートクリアタイマのタイムアップ
    ・Toolsから抜けたとき(RemoteKO等も含む)
    ・メニューからサービスに入った時(全サービス)
参考情報…

プログラム画面でのリセットキー押下、割り込みEntryでは特に表示しません。

パネルがオートクリア処理を実施した時まだパージ確認待ち中であれば表示するという仕様です。2007/2/2【LP-IO-PMC】システム仕様検討会第6回にて合意。
5. ダウンパージ確認待ち中に節電に入った場合、パージ確認待ち中をクリアする。画面も消す。(2007/2/2【LP-IO-PMC】システム仕様検討会第6回にて合意)
参考情報…

PGS1253SGPプロダクトでは、パージ確認待ち中はデバイスエラー状態になっていますので節電には入りません。他の機種(DMP-XI-1b現在)ではデバイスエラーにならない為節電に入ります。節電に入った場合は、UI自身で管理しているパージ待ち中を解除します。

■オブジェクト制御

|項目|取りうる値|表示条件|
|---|---|---|---|
|タイトル|用紙排出|-(固定で表示)|
|確認ボタン|通常のボタンと同じ|-(固定で表示)|
|ステータスメッセージ|表示しない|-|
|メッセージ1|排出した主旨のMSG|-(固定で表示)|
|メッセージ2|スタッカー排出トレイ   :NNN枚<br/>スタッカー1排出トレイ   :NNN枚<br/>スタッカー2排出トレイ   :NNN枚<br/>フィニッシャー排出トレイ :NNN枚<br/>排出トレイ        :NNN枚<br/>|通知された排出先が、HCSトップトレイの時<br/>通知された排出先が、HCS重連で、HCS1トップトレイの時<br/>通知された排出先が、HCS重連で、HCS2トップトレイの時<br/>通知された排出先が、フィニッシャートップトレイの時<br/>通知された排出先が、SCT/OCT の時<br/>通知された枚数も表示する。<br/>複数の箇所通知された場合は、複数表示する<br/>|
|全体イメージ|-他のフォルトと同じ|-(他のフォルト参照)|


■キーの受付・その他
1. Key受付特に制限は設けないが、認証キーは禁止する。
参考情報…

認証キーは実装の都合上受け付けないものとする。パージ画面はジャム・認証画面グループよりプライオリティーを高くして表示している為、認証ボタンを受け付けても、パージの下に表示される事になる為。本件はFCWの実装仕様です。

Cキー、リセットキー、スタートキー、テンキーなども、パージ確認画面では意味の無いキーになるので結果として受け付けないことになる。

**<補足/備考/質疑応答記録など>**

-   質疑応答記録はAPPENDIXに記載

-   -   

### IOTアップパージ動作(CH24088)

###### 基本動作

1. ジャムクリア後、機内に残された用紙を自動的に排出する。

   紙送りの制御はIOT/Controllerの仕様に従う。

2.
UIは、「アップパージ準備中」・「アップパージ実行中」の通知を受けて、対応する表示を行う。

3. 通常は、ジャムクリア後、アップパージがあればアップパージが実行され、続けて印刷ジョブが自動的に再開される。しかし、ジャム画面でジョブのキャンセル操作が可能な為、場合によってはジョブが無い状態でアップパージが実行される場合もある。いずれにしても、UIはアップパージの通知に従い、専用画面を表示消去する。

$

※上記画面は、どのようなオブジェクトを制御するのかを参考として載せている程度ですので、画面の正しい配置・文言等はダイアログ仕様書参考の事。

**<動作仕様>**

■フレーム制御
1. 「アップパージ準備中」または「アップパージ実行中」の通知を受けた時、専用画面を表示する。  
また「アップパージなし(終わり)」の通知を受けた時、画面を消す。
2. 閉じるボタンを押すことで画面を閉じる。
3. 再表示タイミングはダウンパージに同じ。
参考情報…

ダウンパージとアップパージの両方を再表示タイミングで表示する場合、ダウンパージをフォアグラウンド側に表示する。(基本的にはダウンパージはジャムクリア前に確認操作するので重なる事は無い)

アップパージ待ち中・実行中に、例えばInterlockOpenされた場合、アップ―アジ待ち中/実行中の状態は解除され、アップパージ無しが通知される。同様に、アップパージ実行中にJamが発生した場合も実行中の状態は解除され、アップパージ無しが通知される。この様にUIは純粋にアップパージの状態に応じてフレーム表示を行う。

■オブジェクト制御

|項目|取りうる値|表示条件|
|---|---|---|---|
|タイトル|用紙排出|-(固定で表示)|
|閉じるボタン|通常のボタンと同じ|-(固定で表示)|
|ステータスメッセージ|表示しない|-|
|メッセージ1|お待ちください。(MMM分)<br/>ウォームアップ中です<br/>不要な用紙をXXに排出します。<br/>|アップパージ準備中 且つ、FuserWarmupTimeが通知された 且つ 排出先情報が通知された時。|
||お待ちください。<br/>ウォームアップ中です。<br/>不要な用紙をXXに排出します。<br/>|アップパージ準備中 且つ、FuserWarmupTimeが通知されなかった 且つ 排出先情報が通知された時。|
||お待ちください。<br/>不要な用紙をXXに排出しています。<br/>|アップパージ実行中。|
|メッセージ2|スタッカー排出トレイ<br/>スタッカー1排出トレイ<br/>スタッカー2排出トレイ<br/>フィニッシャー排出トレイ <br/>排出トレイ<br/>|通知された排出先が、HCSトップトレイの時<br/>通知された排出先が、HCS重連で、HCS1トップトレイの時<br/>通知された排出先が、HCS重連で、HCS2トップトレイの時<br/>通知された排出先が、フィニッシャートップトレイの時<br/>通知された排出先が、SCT/OCT の時<br/>|
|全体イメージ|-他のフォルトと同じ|-(他のフォルト参照)|


■キーの受付・その他
特になし。

**<補足/備考/質疑応答記録など>**

-   質疑応答記録はAPPENDIXに記載

-   -   

### タブ紙Jam解除後のIOTパージ動作(RF3802/CH19322)

###### 基本動作

1.
タブ紙でジャムが発生した場合、ジャムクリア後、給紙トレイ内の不要なタブ紙のパージを実行する。パージ終了後、自動的にジョブの処理を再開する。

2.
上記のパージ中に、「不要な用紙を排出中。用紙排出後、自動的に再開します。」旨のメッセージを、Run画面(コピーRun/プリントRun)に表示する。

Copy/Print/DocumentFormatPrintで通知される。

※正しくはダイアログ仕様書参考の事

**<動作仕様>**

■フレーム制御
特になし。ラン画面内のメッセージのみ。

■オブジェクト制御

|項目|取りうる値|表示条件|
|---|---|---|---|
|ステータスメッセージ|排出&自動再開主旨のMSG|-TabPurge実行中通知を受けて表示|


■キーの受付・その他
特になし

**<補足/備考/質疑応答記録など>**

-   質疑応答記録はAPPENDIXに記載

-   -   

### APPENDIX

# 本項では、以下の理由から、質疑・背景等を記載します。

レビューの場では、「要求」と「それを実現できるか」という事が対になって話し合われます。

その時話し合われた実現概要や懸念点に対する回答は重要な情報です。

実現概要の話の中にResource
(JRMIF/Controllerから取得できる情報)が登場します。

UIが取得できるResourceに変化があると仕様にも影響します。

UI-DFDには、要求から抽出した「要求仕様」が書かれますが、既存実装から抽出された「実装仕様」も書かれています。

その仕様が、要求仕様としてはここまで求めたかったが、実装上の理由でこのような仕様となった…という経緯を残す事も大切な情報です。また、既存実装の枠組みなので、あえてUI-DFDに記載されていないケースがあります。

**実現方法について、正しくはDFD以降の設計書を参照してください。**

**<IOTダウンパージ>**

――――――――――――――――――――――――――――――――――――――

Q:ジョブではなく、デバイスの情報として通知される。とありますがジョブでない理由は?

A:ジョブ途中だけでなく、故障などによりジョブ終了と同時に起きるケースもあるため。

――――――――――――――――――――――――――――――――――――――

Q:パージ紙がJAMった場合どうなりますか?

A:
1枚でも排出されていればパージ取り除け画面を表示します。1枚も排出されない場合、JRMからパージ通知が来ません。

――――――――――――――――――――――――――――――――――――――

Q:パージ確認画面で、確認を押さなくても継続する仕様はどうかと思います。確実に確認を押させてから動作する仕様のほうが良いのではないでしょうか?

A:【LP-IO-PMC】システム仕様検討会の検討結果を基にしています。

ジョブ終了と同時にパージが起きるケースがあるわけですが、プリンターなどを考えた場合、MCの前に人がいるとは限りません。その場合、

-   パージ確認画面を表示したまま、次のジョブを止めておくのか?

-   それともジョブを受け付けてパージ画面を消しても良いのか?

結果は、ジョブを受け付けてパージ画面は消してよいとの判断からこのような動作となっています。

――――――――――――――――――――――――――――――――――――――

Q:IotEventは、初期化時にトレーやトナーなどの情報を送ってきますが、Purge情報は送ってきませんよね?当然ですが…

A:はい。排出した時(MC停止まで待って)だけ送ってきます。

――――――――――――――――――――――――――――――――――――――

Q:Teakでは、コピー/プリントジョブで送ってくるとの事ですが、DiagXXジョブ中にパージが起きた場合も送ってきますか?

A:はい。送られます。通常通り表示を行い、確認ボタンまたはIotState=Printで消去します。

何度か出ていますが、ジョブではなくデバイスの状態です。

――――――――――――――――――――――――――――――――――――――

Q:既存のTarzanプロダクトD2-FINなども、スタッカー側排出中にジャムると、排出先を変えてトップトレイに出す動作を行っていると聞きました。パージ動作はTeakからなのでしょうか?

A:
はい。実は今でもFinisherは独自でゲートを切り替えてパージ動作しています。

ただし、今までシステム要件としてパージ表示が無かったためUIへパージ通知していません=表示もしていません。

Teakで今回初めてパージ通知が来ることになります。

――――――――――――――――――――――――――――――――――――――

Q:Purge確認画面がいる状態で、再度Purgeが通知された場合、どうなりますか?

A:
前のを消して後から通知されたものを出しなおします。排出先も後から通された情報のみを使います。

――――――――――――――――――――――――――――――――――――――

Q:JRMからの通知は、MC停止まで待ってパージが通知されます。とありますがどういう意味ですか?

A: パージはMC動作中に通知されません。必ずMCが停止してから通知されます。

理由は、複数箇所で起きた場合を考えるとわかりやすいのですが、起こった箇所毎イベント通知されてもPanelは最後のもしか表示できません。1つのイベントでパージ先複数あるよ!、と通知を受けないと複数箇所の表示は出来ないためです。

――――――――――――――――――――――――――――――――――――――

Q:パージ紙は課金対象ですか?

A: パージ紙はJAM紙と同じ扱いなので課金対象にならない。

――――――――――――――――――――――――――――――――――――――

Q:パージ確認画面で、Cボタン(ジョブキャンセル)は効きますか?

A:効きません。パージ確認画面はジョブに結びつきません。

――――――――――――――――――――――――――――――――――――――

**<IOTタブアップパージ>**

――――――――――――――――――――――――――――――――――――――

Q:実際のデバイスの動きについてもう少し説明してください。パージ後一旦保留して自動的に再開するのですか?

A:プリントジョブを例にします。(1)まずJAMでジョブが停まります。(2)ジャムクリアします。(3)そうすると自動的にIOTが動き出します。この後(通常ですと、パージ紙が無いのでプリント動作となりますが)パージ紙排出動作が入り、パージ紙を排出するとIOT動作は停止することなく、そのまま残りのプリント動作に遷移します。この間StateはProcessingのままです。

コピーであれば、原稿の読み込みの状態によって、ジャムクリア後、ユーザー操作待ち、或いは自動再開となります。

――――――――――――――――――――――――――――――――――――――