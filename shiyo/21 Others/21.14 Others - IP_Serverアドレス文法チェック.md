## IP\_Serverアドレス文法チェック

### <IPv6対応>IPアドレス/Server名の文法チェック

###### RF1314/CH12734

DMP2007-1以降、IPv6プロトコルへの対応に伴い、
TCP/IP動作モード の設定が追加され、また、デバイスに対する IP
Address/Server Nameの設定が全て
リテラル(文字列)にて行われることになった。
それに伴い、Panel-UIから各種IP Address/Server
Nameの設定や参照を行う場合に、都度適切な文法チェックを行う必要が生じた。
本章では、具体的に実施する文法チェックの種類と、対象箇所、実施ルール等に付いて記載する。

###### BG114390 / CH16974

  IP/Serverアドレス文法チェックにおいて、FQDN以外の形式でホスト名を設定するケースを考慮し、入力文字列が「その他」の場合にホスト名としての解釈し「有効」の扱いとしていたが、

1.  IPv4/IPv6/FQDNのいずれかの値を指定できるもの

2.  IPv4/IPv6/FQDN/NetBIOS名のいずれかの値を指定できるもの

3.  FQDN/NetBIOS名のいずれかの値を指定できるもの

  の対象として、基本は全て 1.
であり、2. に該当するのはSMBのサーバ名/ドメイン名に限定される旨が確認できたため、判断条件を追加/変更する。

具体的には以下。

-「SMBのサーバ名/ドメイン名」以外 … 既存の判断条件を変更

-「SMBのサーバ名」    … 専用の判断ケースを追加

-「SMBのドメイン名」    … 専用の判断ケースを追加

######  RF4655/CH25536

  IP/Serverアドレス文法チェックにおいて、

1.  IPv4/FQDNのいずれかとして有効な文字列か(I)

2.  IPv6/FQDNのいずれかとして有効な文字列か(J)
を追加した。

#### 文法チェックの種類

###### 概要

UIで実施する、基本的な文法チェックの種類は以下。

|種類|主な用途|文法チェックの種類|判断条件|
|---|---|---|---|---|
|A|Tools>本体アドレスの設定|IPv4アドレスの文法チェック<br/>※指定された文字列が、<br/>IPv4アドレスとして有効な文字列か?<br/>|1. 入力された文字列の種類を取得する<br/>1-1. 「IPv4アドレス」ならば 2. へ<br/>1-2. 「IPv4アドレス以外」ならば NG<br/>2. 入力された文字列が、IPv4アドレスとして有効かを判断する<br/>2-1. 「指定可能」ならばOK<br/>2-2. 「指定可能以外」ならばNG<br/>|
|B|Tools>本体アドレスの設定|IPv6アドレスの文法チェック<br/>※指定された文字列が、<br/>IPv6アドレスとして有効な文字列か?<br/>|1. 入力された文字列の種類を取得する<br/>1-1. 「IPv6アドレス」ならば 2. へ<br/>1-2. 「IPv6アドレス以外」ならば NG<br/>2. 入力された文字列が、IPv6アドレスとして有効かを判断する<br/>2-1. 「指定可能」ならばOK<br/>2-2. 「指定可能以外」ならばNG<br/>|
|C|Tools><br/>各種IP/Serverアドレスの設定<br/>※SMBサーバーを除く<br/>|IP/Serverアドレスの文法チェック - 1<br/>※指定された文字列が、<br/> IPv4/IPv6/FQDNのいずれかとして有効な文字列か?<br/>|<ol type="1"><li>入力された文字列の種類を取得する<br/></li></ol>1-1. 「IPv4アドレス」ならば 2. へ<br/>1-2. 「IPv6アドレス」ならば 3. へ<br/>1-3. 「FQDNアドレス」ならば OK<br/>1-4. 上記以外ならば NG<br/>2. 入力された文字列が、IPv4アドレスとして有効かを判断する<br/>2-1. 「指定可能」ならばOK<br/>2-2. 「指定可能以外」ならばNG<br/>3. 入力された文字列が、IPv6アドレスとして有効かを判断する<br/>3-1. 「指定可能」ならばOK<br/>3-2. 「指定可能以外」ならばNG<br/>|
|D|Service><br/>各種IP/Serverアドレスの設定<br/>※SMBサーバーを除く<br/>|IP/Serverアドレスの文法チェック - 2<br/>※指定された文字列が、<br/> IPv4/IPv6/FQDN のいずれかとして有効な文字列で、且つ、現在のTCP/IP動作モードに対応しているか?<br/>|<ol type="1"><li>入力された文字列の種類を取得し、現在の動作モードに適しているかを判断する<br/></li></ol>1-1. 「IPv4アドレス」かつ動作モードが 「IPv4 or DUAL」ならば 2. へ<br/>1-2. 「IPv6アドレス」かつ動作モードが 「IPv6 or DUAL」ならば 3. へ<br/>1-3. 「FQDNアドレス」ならば OK<br/>1-4. 上記以外ならば NG<br/>2. 入力された文字列が、IPv4アドレスとして有効かを判断する<br/>2-1. 「指定可能」ならばOK<br/>2-2. 「指定可能以外」ならばNG<br/>3. 入力された文字列が、IPv6アドレスとして有効かを判断する<br/>3-1. 「指定可能」ならばOK<br/>3-2. 「指定可能以外」ならばNG<br/>|
|E|Tools><br/>PROXY Serverアドレスの設定<br/>|PROXY Serverアドレスの文法チェック<br/>※指定された文字列が、<br/> IPv4/IPv6/FQDN のいずれかとして有効な文字列か?<br/>|<ol type="1"><li>入力された文字列の種類を取得する<br/></li></ol>1-1. 「IPv4アドレス」ならば 2. へ<br/>1-2. 「IPv6アドレス」ならば 3. へ<br/>1-3. 「FQDNアドレス」ならば OK<br/>1-4. 上記以外ならば NG<br/>2. 入力された文字列が、IPv4アドレスとして有効かを判断する<br/>2-1. 「指定可能」ならばOK<br/>2-2. 「指定可能以外」ならばNG<br/>3. 入力された文字列が、IPv6アドレスとして有効かを判断する<br/>3-1. 「指定可能」ならばOK<br/>3-2. 「指定可能以外」ならばNG<br/>|
|F|Tools><br/>各種IP/Serverアドレスの設定<br/>※SMBサーバー向け<br/>|<SMB> IP/Serverアドレスの文法チェック - 1<br/>※指定された文字列が、<br/> IPv4/IPv6/FQDN/NetBIOSホスト名 のいずれかとして有効な文字列か?<br/>|<ol type="1"><li>入力された文字列の種類を取得する<br/></li></ol>1-1. 「IPv4アドレス」ならば 2. へ<br/>1-2. 「IPv6アドレス」ならば 3. へ<br/>1-3. 「FQDNアドレス」ならば OK<br/>1-4. 上記以外ならば 4. へ<br/>2. 入力された文字列が、IPv4アドレスとして有効かを判断する<br/>2-1. 「指定可能」ならばOK<br/>2-2. 「指定可能以外」ならばNG<br/>3. 入力された文字列が、IPv6アドレスとして有効かを判断する<br/>3-1. 「指定可能」ならばOK<br/>3-2. 「指定可能以外」ならばNG<br/>4. 入力された文字列が、NetBIOSホスト名として有効かを判断する<br/>  4-1. 「有効」ならば OK<br/>  4-2. 「無効」ならば NG<br/>|
|G|Service><br/>各種IP/Serverアドレスの設定<br/>※SMBサーバー向け<br/>|<SMB> IP/Serverアドレスの文法チェック - 2<br/>※指定された文字列が、<br/> IPv4/IPv6/ FQDN/NetBIOSホスト名 のいずれかとして有効な文字列で、且つ、現在のTCP/IP動作モードに対応しているか?<br/>|<ol type="1"><li>入力された文字列の種類を取得し、現在の動作モードに適しているかを判断する<br/></li></ol>1-1. 「IPv4アドレス」かつ動作モードが 「IPv4 or DUAL」ならば 2. へ<br/>1-2. 「IPv6アドレス」かつ動作モードが 「IPv6 or DUAL」ならば 3. へ<br/>1-3. 「FQDNアドレス」ならば OK<br/>1-4. 上記以外ならば 4. へ<br/>2. 入力された文字列が、IPv4アドレスとして有効かを判断する<br/>2-1. 「指定可能」ならばOK<br/>2-2. 「指定可能以外」ならばNG<br/>3. 入力された文字列が、IPv6アドレスとして有効かを判断する<br/>3-1. 「指定可能」ならばOK<br/>3-2. 「指定可能以外」ならばNG<br/>4. 入力された文字列が、NetBIOSホスト名として有効かを判断する<br/>  4-1. 「有効」ならば OK<br/>  4-2. 「無効」ならば NG<br/>|
|H|SMBサーバーのドメイン名設定|<SMB> ドメイン名の文法チェック<br/>※指定された文字列が、<br/> FQDN/NetBIOSホスト名 のいずれかとして有効か?<br/>|<ol type="1"><li>入力された文字列の種類を取得する<br/></li></ol>1-1. 「IPv4アドレス」ならば NG<br/>1-2. 「IPv6アドレス」ならば NG<br/>1-3. 「FQDNアドレス」ならば OK<br/>1-4. 上記以外ならば 2. へ<br/>2. 入力された文字列が、NetBIOSホスト名として有効かを判断する<br/>  2-1. 「有効」ならばOK<br/>  2-2. 「無効」ならば NG<br/>|
|I|Ping接続確認のアドレス、プロトコル一致判定|IPv4/Serverアドレスの文法チェック<br/>※指定された文字列が、<br/>IPv4/FQDNのいずれかとして有効な文字列か?<br/>|1. 入力された文字列の種類を取得する<br/>1-1. 「IPv4アドレス」ならば 2.へ<br/>1-2. 「FQDNアドレス」ならば OK<br/>1-3. 上記以外ならば NG<br/>2. 入力された文字列が、IPv4アドレスとして有効かを判断する<br/>2-1. 「指定可能」ならばOK<br/>2-2. 「指定可能以外」ならばNG<br/>|
|J|Ping接続確認のアドレス、プロトコル一致判定|IPv6/Serverアドレスの文法チェック<br/>※指定された文字列が、<br/>IPv6/FQDNのいずれかとして有効な文字列か?<br/>|1. 入力された文字列の種類を取得する<br/>1-1. 「IPv6アドレス」ならば 2.へ<br/>1-2. 「FQDNアドレス」ならば OK<br/>1-3. 上記以外ならば NG<br/>2. 入力された文字列が、IPv6アドレスとして有効かを判断する<br/>2-1. 「指定可能」ならばOK<br/>2-2. 「指定可能以外」ならばNG<br/>|


###### 制限・注意事項/備考

-   UIは、以下のライブラリを利用して上記記載の判断を行う。各ライブラリの詳細仕様は、共通Lib仕様書「XXX」を参照。

    -   アドレスの種類の取得ライブラリ : IpssGetAddrType()

    -   アドレスの有効判断ライブラリ : IpssCheckInetAddr()

###### SMB Clientライブラリ仕様書

-   NetBIOSホスト名の判断ライブラリ : SmbclValidateNBHost()


-   Email、インターネットファクス、ServerFAX宛先に対する文法チェックは、別途提供されている宛先アドレスチェックを利用する。(従来どおり)

###### 参考資料

-   

#### 対象箇所と実施ルール

対象となる画面や項目に応じて、適切な文法チェックを実施する必要があるため、実施する必要のある箇所、ルールやタイミング(例)を記載する。 

ただし、最終的な実施タイミングについては、Dialog仕様書を参照のこと。

##### サービス

###### 概要

一般ユーザーが利用するサービス画面では、現在設定されているTCP/CP動作モードを考慮して、適切なアドレス設定か否かを判断する。

||カテゴリ|対象項目|種類|実施タイミング|備考|
|---|---|---|---|---|---|---|
||ScanToPC|FTPサーバー名|D|キーボードからの入力確定時||
|||||宛先表からの宛先追加時||
|||SMBサーバー名|G|キーボードからの入力確定時||
|||||宛先表からの宛先追加時||


###### 制限・注意事項/備考

-   ジョブテンプレート選択時のチェックは実施しない。
(JT設定は有効、パネル選択可能だが、ジョブを起動した結果「ネットワーク接続エラー」となる。)

-   ジョブフロー>アドレス型項目に対するチェックは実施しない。

-   CH16794 により、SMBサーバーは判断条件を変更

##### 登録

###### 概要

一般ユーザーと管理者が利用する登録画面では、現在のユーザーに応じて、以下とする。

-   CO/AA
    : 現在設定されているTCP/CP動作モードを考慮して、適切なアドレス設定か否かを判断する

-   SA/KO/CE
    : 現在設定されているTCP/CP動作モードを考慮せず、有効となりうるアドレス設定か否かを判断する

||カテゴリ|対象項目|種類|実施タイミング|備考|
|---|---|---|---|---|---|---|
||宛先表><br/>サーバー<br/>|FTPサーバー名/IPアドレス|D|キーボードからの入力確定時|CO/AAユーザー時|
||||C||SA/KO/CEユーザー時|
|||SMBサーバー名/IPアドレス|G|キーボードからの入力確定時|CO/AAユーザー時|
||||F||SA/KO/CEユーザー時|


###### 制限・注意事項/備考

-   ジョブフロー>FTP転送/SMB転送に対するチェックは実施しない。

-   CH16794 により、SMBサーバーは判断条件を変更

##### 仕様設定

###### 概要

管理者が利用する使用設定画面では、現在設定されているTCP/CP動作モードを考慮せず、有効となりうるアドレス設定か否かを判断する。

   ※実際には、以下に例として記載した項目以外においても、IPアドレス/サーバーアドレス等を設定可能な項目については、同様に必要な文法チェックを実施する必要がある。

||カテゴリ|対象項目|種類|実施タイミング|備考|
|---|---|---|---|---|---|---|
||共通><br/>システム時計/タイマー設定<br/>|時刻サーバー(NTP)と同期|C|キーボードからの入力確定時||
||ネットワーク><br/>プロトコル設定<br/>|IPv4-IPアドレス<br/>IPv4-ゲートウェイアドレス<br/>|A|キーボードからの入力確定時||
|||IPv4-サブネットマスク|A||制限・注意事項あり|
|||IPv6-手動設定アドレス<br/>IPv6-手動設定ゲートウェイアドレス<br/>|B||制限・注意事項あり|
||ネットワーク設定><br/>メール送受信設定<br/>|POP3サーバー名/IPアドレス<br/>SMTPサーバー名/IPアドレス<br/>|C|キーボードからの入力確定時||
||ネットワーク設定><br/>外部認証サーバー設定<br/>|Kerberosサーバー<br/>LDAPサーバー<br/>その他<br/> 各種サーバー名/IPアドレス<br/>|C|キーボードからの入力確定時||
|||SMBサーバー設定<br/>各種サーバー名/IPアドレス<br/>|F|キーボードからの入力確定時||
|||SMBサーバー設定<br/>   ドメイン名<br/>|H|キーボードからの入力確定時||
||ネットワーク設定><br/>その他の設定<br/>|バックアップツールのホスト名/IPアドレス|C|キーボードからの入力確定時||
||ネットワーク設定><br/> プロキシサーバー設定<br/> EPプロキシサーバー設定<br/>|HTTPプロキシサーバー名 – サーバー名<br/>HTTPSプロキシサーバー名 – サーバー名<br/>|E|キーボードからの入力確定時|CH13318|
||ネットワーク設定><br/> SIP設定<br/>|プロキシサーバー設定<br/>  プライマリーサーバーアドレス<br/>  セカンダリーサーバーアドレス<br/>レジストラサーバー設定<br/>  プライマリーサーバーアドレス<br/>  セカンダリーサーバーアドレス<br/>VoIPゲートウェイ登録<br/>  アドレス<br/>|C|キーボードからの入力確定時|CH15300,CH15287|
||ネットワーク設定><br/>プロトコル設定><br/>Ping接続確認<br/>|IPアドレス/ホスト名|I, J|キーボードからの入力確定時|RF4655/CH25536|


###### 制限・注意事項/備考

-   IPv4-サブネットマスク
上記に加え、UI内部で以下の判断を行う。

-   xxx.xxx.xxx.xxxの各xxx部分が、000、128、192、224、240、248、252、254、255のいずれか値であること。

-   xxx.xxx.xxx.xxxの文字列を数値(4byte)形式にした場合、途中のビットが0にならないこと。


-   IPv6-手動設定アドレス
IPv6アドレスとしての有効判断時、リンクローカルアドレスは「指定不可」とする。

-   IPv6-手動設定ゲートウェイアドレス
IPv6アドレスとしての有効判断時、リンクローカルアドレスは「指定可能」とする。

-   HTTPプロキシサーバー名 – サーバー名、HTTPSプロキシサーバー名 –
    サーバー名
IPv6アドレスとしての有効判断時、リンクローカルアドレスは「指定可能」とする。

-   

### <IPSEC対応>相手先アドレスの文法チェック

###### RF917/CH12446

本章では、IPSECで指定する相手アドレス指定に関する文法チェックに付いて記載する。

#### 文法チェックの種類

###### 概要

UIで実施する、基本的な文法チェックの種類は以下。

||文法チェックの種類|判断条件|
|---|---|---|---|
|A|IPSEC相手アドレスの文法チェック(IPv4)|入力された文字列の有効性を判断し、<br/><ul><li>「正常なIPv4アドレス」ならばOK<br/></li><li>それ以外ならばNG<br/></li></ul>|
|B|IPSEC相手アドレスの文法チェック(IPv6)|入力された文字列の有効性を判断し、<br/><ul><li>「正常なIPv6アドレス」ならばOK<br/></li><li>それ以外ならばNG<br/></li></ul>|


###### 制限・注意事項/備考

-   UIは、以下のライブラリを利用して上記記載の判断を行う。各ライブラリの詳細仕様は、共通Lib仕様書「XXX」を参照。
\- IPsec接続先アドレスフォーマットの検証ライブラリ
: SecIpsecPeerAddrCheck ()

-   空文字を設定した場合、ライブラリからNGが通知される。UI内部での判断は不要。

###### 参考資料

-   

#### 対象箇所と実施ルール

IPSECへの対応は、KO設定のみ。

##### 仕様設定

###### 概要

管理者が利用する使用設定画面では、現在設定されているTCP/CP動作モードを考慮せず、有効となりうるアドレス設定か否かを判断する。

||カテゴリ|対象項目|種類|実施タイミング|備考|
|---|---|---|---|---|---|---|
||ネットワーク設定><br/>セキュリティ設定>IPSec設定<br/>|IPSEC相手アドレスの指定の有無[IPv4]|A|キーボードからの入力確定時||
|||IPSEC相手アドレスの指定の有無[IPv6]|B|キーボードからの入力確定時||


###### 制限・注意事項/備考

-   