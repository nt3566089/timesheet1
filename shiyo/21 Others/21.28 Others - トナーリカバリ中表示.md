## トナーリカバリ中表示(Kisyu, DMP9-2以降のみ)

###  要求の背景

次の2つの理由からトナーリカバリ中表示の要求が上がった。

**1.トナーリカバリが不十分になるケースが発生するため**
現状ではトナーカートリッジ交換後のトナーリカバリ中の状態でもUIに「トナー要交換」のメッセージが表示され続けるため、ユーザーがIOTフロントカバーを開けてしまう。開けてしまうとトナーリカバリが止まってしまうため、トナー残量が増えず「要交換」ステータスのままとなってしまう。

**2. ユーザーが誤って新品トナーを交換してしまう可能性があるため**
現状ではトナーカートリッジ交換を行った直後は「トナー要交換」表示のままであるため、それを見たユーザーが誤って再度新品のトナーカートリッジと交換してしまう可能性がある。

-   Kisyuでは、過去機種に比べてリカバリ中の動作音がより静かになったために、これらの事態が発生し易くなっている。

###  動作仕様
**<表示・消去仕様> **
1. トナーカートリッジ交換操作の有無に関わらず、トナーリカバリ中になった場合に次の表示を行う。

1.  IOT系ジョブ実行中にトナーEmptyが発生しジョブが異常保留したケースでは、トナーリカバリ動作発生時にトナー要交換Fault画面の中身[1]を「トナー調整中」表示に差し替えて表示する。ジョブ状態確認画面からジョブ詳細表示指示を行った場合も同様の表示となる。

2.  機械確認>消耗品確認>消耗品確認Popupを表示した/していた時にトナーリカバリ動作が発生した場合は、Popupの中身を「トナー調整中」表示に差し替えて表示する。(MNテリトリのみの対応….CH16667にて追加)

3.  機械確認>Active
    > Faultより「トナー交換解除手順」の画面を開いた/開いていた時にトナーリカバリ動作が発生した場合は、Popupの中身を「トナー調整中」表示に差し替えて表示する。(MNテリトリのみの対応….CH16667にて追加)

4.  ①～③以外の状態でトナーリカバリ動作が発生した場合は、ステータスメッセージエリアに「トナー調整中」である旨を表示する。
2.
トナーリカバリ動作が完了したら、上記「トナー調整中」表示を取り止める。また、②③の場合は、トナー調整中を表示しているPopup画面を自動的に閉じ、1つ上位の画面に遷移する。
3.
上記①ようなジョブ中のケースであっても、ジョブ異常保留にならなかった(=トナーEmptyを経由せずにトナーカートリッジを交換した)場合には、Fault画面による「トナー調整中」メッセージは表示されない。[2]
4.
上記④のステータスメッセージのメッセージ表示優先順位は、消耗品状態通知メッセージと同じレベル・表示/消去条件とする。
ただし、機械確認-消耗品一覧タブを開いた場合も消耗品メッセージを表示する[3]。消耗品メッセージ内の表示優先順位は最優先とする。

**<関連するシステムデータ>**

** **なし。

**<制限注意事項>**

-   本件は、DMP9-1以降の共通仕様として導入する。(Kisyuバイプロ仕様ではない)[4]

-   ステータスメッセージエリア表示の場合、表示すべき複数の消耗品状態がある場合は、トナー調整中メッセージが表示されないことがある[5]。

-   トナーリカバリが完了しないと、トナーカートリッジStateは変化しない。また、ジョブステータスも変化しない。このため、トナーリカバリ動作中には、次のような制限事項が発生する。

1.  エラーLEDは点灯したまま変化しない。

2.  電源ON直後にトナーEmpty、Near
    > Emptyを検知した場合には消耗品情報popup画面が表示される。この状態でトナーリカバリが発生するが、Popup内の消耗品状態の表示はEmptyのままとなる。(ただし、メッセージエリアには上記表示仕様に基づき「トナー調整中」が表示される)

3.  トナーリカバリ中にジョブ起動すると、「要トナー交換」という趣旨のメッセージが表示される(現実装のまま変更なし)。本件は、マニュアルの注意・制限事項として記載する。

    -   他の「お待ちください」表示のような、目安となる待ち時間表示は行わない。理由は次の2点。
① IOT側の開発者からの指摘…リカバリ時間はケースによって大きく変化するため、具体的な分数表示は馴染まない。(表示した時間以上に待つことも十分にある)
② HID松尾さんのコメント…①の情報を添えて具体的な待ち時間表示をすべきか否かについてHID松尾さんに確認したところ、「不要」とのコメントを頂いた。

**<参考:Kisyuのトナーリカバリ動作について>**

\-  トナーリカバリが実行されるのは次のケース。

① ジョブ中

② ジョブ終了後

③ 設置後

④ Near Empty、PreNearEmpty時のIOTインターロック開閉

⑤ M/C設置時

⑥ 電源ON時(トナー濃度検知結果による)
\-  トナーリカバリの所要時間の目安は2～3分。設置時は5分。

-   HID要求の「Near Emptyで『要交換』表示」と本件は無関係。 Near
    Emptyでトナー交換してもリカバリに掛かる時間は5秒程度しか変わらないため、本課題には影響がない。

**<参考:Rookieのトナーリカバリ動作について>**

-   トナーリカバリが実行されるケースと所要時間は次の通り。

1.  ジョブ中・ジョブ終了後: 約1分

2.  設置後: 2～3分

3.  Near Empty、PreNearEmpty時のIOTインターロック開閉 :2～3分

4.  M/C設置時: 約6.5分(CRUインストール時間(Kishuには無い)を含む)

5.  電源ON時(トナー濃度検知結果による?):2～3分

-   

[1] 具体的には、グラフィック表示は消し、メッセージは「お待ちください。トナー調整中です。IOTインターロックを開けないでください。」を赤画面で表示する(文言の言い回しはDialogue仕様書を参照のこと)。

[2] このケースではそもそもトナー切れFail画面が表示されないため、調整中メッセージも表示できない。

[3] 【実装者への情報】 ベースフレーム切り替え時だけでなく、タブ切り替えでのupdateが必要。

[4] 【実装者への情報】 システム設計上の役割分担として、トナーリカバリ動作を表示するか否か(あるいはトナーリカバリ動作そのものがあるかどうかについても)は、IOTscが判断することになっている。つまり、トナーリカバリ表示が必要な場合はIOTscが該当リソースの更新を行う。JRMはそのリソース変化を元にUIに対してIotStateEventを送出する。UIはIOTの種別を意識することなく、ただ単にそのイベントを受信したときに、一連の動作を行えばよい。

[5] 具体的には、Recovering、Type Mismatch、Not In Position、Brokenのいずれかが発生している場合。表示は「未装着または交換が必要な消耗品があります。\[機械確認\]の\[消耗品確認\]画面で確認してください」となる。