## Auto Clear
###### 概要
Auto
Clearはユーザ操作をキャンセルし、初期表示状態に戻す機能である。デバイスで提供する機能に制限を生じるFailの発生、認証解除、UI操作後の放置等の要因により発動する。発動時に初期表示状態に戻す際に行われる処理(以降、付随動作)は、その時点のシステムの状態により異なる。また、中断不可能な処理の実施中や、ユーザに待機を要求する処理の実施中では、Auto
Clearの要因によりその時点では実施されず、処理終了まで遅延することや、要因を無視し、Auto
Clear処理を行わないこともある。
以下に、詳細を記述する。
###### Auto Clear要因
Auto Clearを発動する要因について、以下に記述する。

|**要因**|**発生ケース**|**UI操作以外で発生**|
|---|---|---|---|
|SystemDown|SystemFail/SubSystemFailが発生し、Ready状態→Down状態が発生した。|○|
|LocalFail/ServiceFail|IIT/IOTのシステムの一部にFailが発生した。PGS2035SGP/Fax/Mediaなど接続機器に機能提供出来ないFailが発生した。|○|
|認証解除|UI上、もしくは外部認証機器上から認証解除が行われた。|○|
|節電Entry|節電Timerの発火、節電キー押下によりReady状態→LowPower/Sleepへの遷移が行われた。|○|
|自動リセットタイマー|自動リセットタイマーが発火した(詳細はUI-DFD 14.1 Timerを参照)。|○|
|外部からの設定終了|RemoteKO,RemoteMaintenaceや外部機器からの設定変更が終了した。|○|
|電源ON,節電Exit|電源ON、節電復帰に伴う初期起動画面表示。|○|
|ToolsExit|登録/変更、仕様設定、言語切り替えなど、UI上からの設定が終了した。|×|
|CE Entry/Exit|CEモードへの遷移、CEモードの解除。|×|

###### Auto Clear動作制限
UIでは処理に応じて自動リセットの禁止や、ユーザ操作を制限する場合がある。このような状態では、Auto
Clearを要求されても、Auto Clearの発動を制限するケース(以降、Auto
Clear動作制限)がある。Auto Clear動作制限では、UIの状態とAuto
Clear要因により、どのように動作を制御するかを決定する。
以下の表にUI内部の状態に対応してAuto
Clear要因が発生したときの動作を示す。なお、UIが操作画面を提供しない状況で発生する「電源ON、節電Exit」はあらかじめ除外する。

|**要因→**|**System Down**|**LocalFail**<br/>**ServiceFail**<br/>|**認証解除**|**節電Entry**|**自動リセット**|**外部からの**<br/>**設定変更終了**<br/>||
|---|---|---|---|---|---|---|---|---|
|**制限状態**|**説明**|||||||
|制限なし|通常のユーザ操作可能な状態|◎|◎|◎|◎|◎|◎※1|
|自動リセット禁止|自動リセットのみ禁止された状態|◎|◎|◎|◎※2|×※3|◎※1|
|設定変更中|設定変更など、UserMode=Tools|◎|×|◎|◎※2|◎|-|
|制限待機状態|マニュアル製本処理中など、処理が終わるまで操作が制限された状態|◎|×|△|◎※2|×|◎※1|
|動作禁止|Diag中など、全ての要因を禁止。|×|×|△※4|×※2|×|×|

◎: 即時実施、△: 制限解除後実施、×: 無視
  ※1  ユーザー非操作状態では外部機器から設定される可能性あり。
  ※2  UIの状態と節電Entry禁止は関連が無いため。
  ※3  自動リセットタイマーをリトリガーする。
  ※4 
現時点ではDiag以外に**動作禁止**は存在せず、かつDiagはCEでしか実施できないため、認証解除が発生することは起こり得ない。
上記、制限状態が複数同時に発生した場合には、制限は総和となる。
###### Auto Clear発生時の付随動作の実行制御
Auto
Clearはその時の状態により、UIを初期状態に戻すために行われる動作が異なる。それらのAuto
Clear時に行われる各動作をAuto Clear付随動作と定義する。Auto
Clear付随動作は、複数の動作が互いに関係を持ち、処理する順序を保証しなくてはいけない場合がある。Auto
Clear付随動作の実行制御は、これらの順序制御を実現する。
各付随動作は、優先順位の高いものから低いものの順に実施される。この際、ある付随動作が失敗した場合にはSystemDown以外の要因についてはその時点で動作を中止する。SystemDown要因による動作の場合については、付随動作の失敗は無視し、全てのAuto
Clear付随動作を実施する。
  以下に、優先度と付随動作の関係を示す。

|**優先度**|**付随動作**|**備考**|
|---|---|---|---|
|高<br/>低<br/>|Manual製本モード抜け<br/>ToolsExit<br/>認証解除<br/>画面状態初期化<br/>ユーザー非操作<br/>|CH21957で導入<br/>自動リセットタイマーのみ実施<br/>|

###### 制限・注意事項/備考
- 動作制限の「制限待機状態」時の動作についてはCH22749導入以降有効となる。未導入の場合にはそれ以外の状態の和となる。  
- 優先順位により付随動作を行う制御についてはCH22749導入以降有効となる。未導入の場合には付随動作は初期画面表示前に実施され、順序は保証されない。