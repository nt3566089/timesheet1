3.0. 構成
====

3.1. ファイル構成
------------

Widgetを構成するファイルの種別、役割、命名規則を以下のように定める。

-   各Widgetを構成するファイル

各Widgetを構成するファイル群は、その種別を問わず、Widgetごとに設けたフォルダ内に格納される。

-   CSS(Cascading Style Sheet)ファイル

> Themeに依存したスタイル情報、レイアウト情報を定義する。
>
> ＜テーマカラー（後述）の影響を受けないもの＞

-   cscw.{Widgetオブジェクト名称}.css

-   cscw.{Widgetオブジェクト名称}.own.css

> ＜テーマカラーの影響を受けるもの＞

-   cscw.{Widgetオブジェクト名称}.{テーマカラー}.css

<!-- -->

-   JavaScriptファイル

> オブジェクトの機能や動作を実現する。コンストラクタ/実行メソッド等が定義されている。
>
> レイアウト情報を含む場合がある。

-   cscw.{Widgetオブジェクト名称}.js

-   cscw.{Widgetオブジェクト名称}.own.js

<!-- -->

-   他　各Widgetが必要とする設定ファイルなど

    -   各Widgetの性質に依存し、CSSファイル、JavaScriptファイル以外のファイル（ex　JSONファイル）を保持するケースがある。

<!-- -->

-   共通利用ファイル

> CSCWidgetは、以下のファイルを共通で利用する。

-   テクスチャファイル

<!-- -->

-   Widgetオブジェクト内部で使用するテクスチャファイル。

-   ファイル名称については規定しない。

-   格納パスは、textureフォルダ内とする。

<!-- -->

-   提供形態について

> CSCWidgetは、前述の構成に沿って作成されるが、全てのWidgetを1セットで使うケースを考慮し、マージファイルの提供を行う。マージの対象となるのは、CSSファイルとJavaScriptファイルであり、それぞれ以下のような命名ルールにて、allフォルダ内に格納した形で提供される。利用者は環境に合わせてロードするファイルを選択する必要がある。

-   CSS(Cascading Style Sheet)ファイル

> ＜ブランド・ディスプレイサイズの影響を受けるもの＞

-   cscw.all.\[ブランド\].\[ディスプレイサイズ\].css

    -   例）cscw.all.own.wsvga.css、cscw.all.oem.wvga.css

-   ブランド: own、oem、kmi

-   ディスプレイサイズ: wsvga、wvga

> ＜テーマカラーの影響を受けるもの＞

-   cscw.all.\[テーマカラー\].css

<!-- -->

-   JavaScriptファイル

    -   cscw.all. \[ブランド\].\[ディスプレイサイズ\].js

    -   cscw.all.share.js（フレーム間共有データ）

        -   このファイルは固定フレームでロードし、他のフレームから再利用することができる。詳細は$.cscw.Settings.set()を参照

> 上記以外のファイルはマージ対象とならないため、適宜個別に考慮する必要がある。考慮が必要なファイルを以下に示す。

-   texture　以下のファイル一式(画像ファイル)

-   keyboard/conf　以下のファイル全て（JSONファイル）

ファイル構成の概略を以下の図に示す。

ここで、XXXは各Widget構成ファイルを束ねるフォルダを示す。

<img src="./media/CSCWidget仕様書_1/media/image1.png" style="width:3.2375in;height:3.33282in" />

ファイル構成概略

### 3.1.1. ロード順

> cscwidgetを利用するアプリケーションは、以下の順序でファイルをロードしなければならない

-   cscw.all.{ブランド}.{ディスプレイサイズ}.css

    -   例）cscw.all.own.wsvga.css

-   cscw.all.{テーマカラー}.css

    -   例) cscw.all.blue.css

-   jquery

-   cscw.all.share.js （別フレームでの事前ロード可）

-   cscw.all.{ブランド}.{ディスプレイサイズ}.js

    -   例）cscw.all.own.wsvga.js

> ただし、cscw.all.share.jsに関しては、別フレームでロードして、そのフレームのwindowオブジェクトを
> $.cscw.Settings.set({shareWindow: win})
> として、ロード済みデータの再利用ができる。これによりロードの負荷を減らすことができる。

3.2. 色の制御
--------

> Widgetは、アプリケーションからの指示に基づき、適用される色を制御して描画を行う。
>
> 適用色は、以下の3つの要素から決定される。

1.  アプリケーションによるテーマカラーの指定

2.  Widgetの配置位置による自動制御

3.  アプリケーションによる例外指定

### 　3.2.1. テーマカラーの指定

> アプリケーションは、マークアップ上の要素（通常は&lt;body&gt;）に、以下のデータ属性を付与することにより、該アプリケーションのテーマカラーを設定することができる。
>
> data-cscw-appTheme
>
> テーマカラーとして設定可能な色彩は以下。
>
> テーマカラーは、Widget初期化前に確定されている必要がある。Widget初期化後に、指定を切り替えた場合の挙動は保証しない。

### 　3.2.2. 配置位置による自動制御

> Widgetの中には、アプリケーションのテーマカラーが決まっても、自身の色彩を一意に決定できないものがある。
>
> このような性質のWidgetの色彩を一意に決定するためには、該Widgetが配置される場所の情報が必要となる。
>
> Widgetが、配置される場所は、

-   &lt;body&gt;直下、もしくは、アプリケーションが独自に定義した要素の下

-   内部に他のWidgetを配置することができるWidgetの下

> のいずれかである。
>
> ここで、内部に他のWidgetを配置することができ、自身が背景色を持つことから、内部Widgetに適用する色彩を決定する機能を持つWidgetのことを「コンテナ」と呼ぶ。
>
> コンテナは、自身およびその中に配置されたWidgetに対して、付随的なテーマカラー（コンテナテーマ）を設定する。これにより、単独では色彩を一意に決めることができない部品に対して、適用する色彩を決定したり、特別な色彩を適用したりすることができる。アプリケーション開発者は、Widgetの階層構造を正しく実装すれば、それぞれに適用される色を意識する必要はない。
>
> コンテナから適用される、付随的なテーマカラーを以下に示す。
>
> **コンテナから適用されるテーマカラー**

<table>
<thead>
<tr class="header">
<th>付随的なテーマカラー</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>color</td>
<td><p>コンテナの背景色は、アプリケーションテーマとして指定された色である。</p>
<p>この上に配置される部品は、それを考慮した色彩が適用される。</p></td>
</tr>
<tr class="even">
<td>gray</td>
<td><p>コンテナの背景色は、グレイである。</p>
<p>この上に配置される部品は、それを考慮した色彩が適用される。</p></td>
</tr>
<tr class="odd">
<td>black</td>
<td><p>コンテナの背景色は、黒色である。</p>
<p>この上に配置される部品は、それを考慮した色彩が適用される。</p></td>
</tr>
<tr class="even">
<td>yellow</td>
<td><p>コンテナの背景色は、黄色である。</p>
<p>この上に配置される部品は、それを考慮した色彩が適用される。</p></td>
</tr>
<tr class="odd">
<td>red</td>
<td><p>コンテナの背景色は、赤色である。</p>
<p>この上に配置される部品は、それを考慮した色彩が適用される。</p></td>
</tr>
</tbody>
</table>

> 　
>
> 　コンテナであるか否か、コンテナである場合に、付随的なテーマカラーとして何が適用されるかは、各Widgetの項に記載する。
>
> 　なお、コンテナは、入れ子にして使ってはならない。

### 　3.2.3. アプリケーションによるコンテナ色指定

> 一部のWidgetについては、コンテナの背景色自体が、自動的に決定できないケースが存在する。
>
> それらについては、コンストラクタオプションにて、背景色を設定する機能を提供する。
>
> 詳細は、対象Widgetの詳細を参照のこと。

3.3. CSS
---

### 3.3.1. 名前空間

Widgetで利用するCSSクラス名は、名前空間として**cscw**を用いる。

各クラス名は以下の形式で定義する。
cscw-{Widgetオブジェクト名称}-{任意の名称}

以下に例を示す。

-   buttonで利用するCSSクラス名

    -   cscw-button

    -   cscw-button-label

    -   cscw-button-info

> 等。

### 3.3.2. ディスプレイサイズ

CSCWidgetは、html要素に属性 data-cscw-displaysize
を設定し、値をwvgaかwsvgaにセットする。アプリケーションはcssルールを書く際に、これを利用することができる。

<table>
<thead>
<tr class="header">
<th>Example</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Markup</td>
<td>&lt;div id=”myBox” &gt;&lt;/div&gt;</td>
</tr>
<tr class="even">
<td>CSS</td>
<td><p>[data-cscw-displaySize=wsvga] #myBox {</p>
<p>/* wsvga用のレイアウト */</p>
<p>}</p>
<p>[data-cscw-displaySize=wvga] #myBox {</p>
<p>/* wvga用のレイアウト */</p>
<p>}</p></td>
</tr>
</tbody>
</table>

### 3.3.3. 要素の重なり順

CSCWidgetは、アプリケーションベースの上に浮遊する性質を持つWidgetに対して、描画階層の範囲を規定する。アプリケーションからは、CSCWidgetが定めた範囲内における階層制御を可能とする。CSCWidgetの規定と、アプリケーションから指示された階層制御のための値は、内部的にはz-indexに変換されて適用される。アプリケーションは、アプリケーションのベース部に対して、階層のベースを示す、cscw-baseLayer　を指定することが望ましい。

各Widgetに許容された描画階層を以下に示す。

<table>
<thead>
<tr class="header">
<th><strong>階層</strong></th>
<th><strong>Widget種別</strong></th>
<th><strong>アプリケーション指示</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>7</td>
<td><p>TextField / TextArea / TextFieldList に関連付けられたKeyboard</p>
<p>およびSuggestionPanel *2</p></td>
<td>700-799　の100段階</td>
</tr>
<tr class="even">
<td>6</td>
<td>Alert</td>
<td>600-699　の100段階</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Fault</td>
<td>500-599　の100段階</td>
</tr>
<tr class="even">
<td>4</td>
<td>SlidingMessage</td>
<td>400-499　の100段階</td>
</tr>
<tr class="odd">
<td>3</td>
<td></td>
<td>300-399　の100段階</td>
</tr>
<tr class="even">
<td>2</td>
<td>Popup</td>
<td>100-299 の200段階*1</td>
</tr>
<tr class="odd">
<td>1</td>
<td>SlidePane</td>
<td></td>
</tr>
<tr class="even">
<td>0</td>
<td>（アプリケーションベース）</td>
<td>0</td>
</tr>
</tbody>
</table>

\*1　SlidePaneとPopupは同等の描画階層を利用できるが、両者のデフォルト描画階層値は異なる。

\*2　KeyboardとSuggestionPanelに対して、アプリケーションは同値の階層指示を行うこと。

### 3.3.4. フォント指定

CSCWidgetは、適宜以下の定義を利用してフォントに関する指定を行う。

CSCWidgetを利用するアプリケーション内では、Widget以外の部品を配置する場合もこの定義を利用できる。

　　適用方法：

\[data-cscw-font-所定の文字列\]：　

当該フォント指定を適用したい要素に対して、データ属性として指定する。

.cscw-所定の文字列：

　　
当該フォント指定を適用したい要素に対して、クラス属性として指定する。

**フォント指定（一般）**

<table>
<thead>
<tr class="header">
<th><strong>項目</strong></th>
<th><strong>定義</strong></th>
<th><strong>意味</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>フォントの太さ</td>
<td>[data-cscw-font-weight="bold"]</td>
<td>太字を利用する</td>
</tr>
<tr class="even">
<td></td>
<td>[data-cscw-font-weight="regular"]</td>
<td>通常の太さのフォントを利用する</td>
</tr>
<tr class="odd">
<td></td>
<td>[data-cscw-font-weight="light"]</td>
<td>細字を利用する</td>
</tr>
<tr class="even">
<td></td>
<td>[data-cscw-font-size="x_small"]</td>
<td>フォントサイズ　x_smallを利用する</td>
</tr>
<tr class="odd">
<td></td>
<td>[data-cscw-font-size="small"]</td>
<td>フォントサイズ　smallを利用する</td>
</tr>
<tr class="even">
<td></td>
<td>[data-cscw-font-size="medium"]</td>
<td>フォントサイズ　mediumを利用する</td>
</tr>
<tr class="odd">
<td></td>
<td>[data-cscw-font-size="large"]</td>
<td>フォントサイズ　largeを利用する</td>
</tr>
<tr class="even">
<td></td>
<td>[data-cscw-font-size="large_t"]</td>
<td>フォントサイズ　large_tを利用する</td>
</tr>
<tr class="odd">
<td></td>
<td>[data-cscw-font-size="index"]</td>
<td>フォントサイズ　indexを利用する</td>
</tr>
<tr class="even">
<td></td>
<td>[data-cscw-font-size="common_m"]</td>
<td>フォントサイズ　common_mを利用する</td>
</tr>
<tr class="odd">
<td></td>
<td>[data-cscw-font-size="common_l"]</td>
<td>フォントサイズ　common_lを利用する</td>
</tr>
<tr class="even">
<td>フォント種別</td>
<td>.cscw-glyph</td>
<td>グリフ用フォントを利用する</td>
</tr>
<tr class="odd">
<td>フォント色</td>
<td>.cscw-font-color-addInfo</td>
<td>付加情報テキスト表示用の色彩を利用する</td>
</tr>
<tr class="even">
<td></td>
<td>.cscw- font-color-notifyError</td>
<td>エラー情報表示用の色彩を利用する</td>
</tr>
<tr class="odd">
<td></td>
<td>.cscw- font-color-notifyWarning</td>
<td>警告情報表示用の色彩を利用する</td>
</tr>
<tr class="even">
<td></td>
<td>.cscw- font-color-notifyInfo</td>
<td>情報表示用の色彩を利用する</td>
</tr>
</tbody>
</table>

用紙を示すGlyph用のフォントカラーとして、以下を定義する。

**フォント指定（用紙Glyph用）**

<table>
<thead>
<tr class="header">
<th><strong>定義</strong></th>
<th><strong>意味</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>.cscw-paperColor-white</td>
<td>用紙色：white　を示す色彩を利用する。</td>
</tr>
<tr class="even">
<td>.cscw-paperColor-gray</td>
<td>用紙色：gray　を示す色彩を利用する。</td>
</tr>
</tbody>
</table>

### 3.3.5. 表示言語の指定

いくつかのWidgetはWidget化する要素のlang属性の属性値に表示言語を指定することで対応するフォントファミリーやフォントサイズを適用することができる。これにより$.cscw.Settingsによる共通初期設定に関わらずWidgetごとに表示言語を指定することができる。

\[対象Widget\]

InteractiveListItem, ReadOnlyListItem, Text, TitleArea

<table>
<thead>
<tr class="header">
<th>Example</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Markup</td>
<td><p>&lt;html lang=”en”&gt;</p>
<p>省略</p>
<p>&lt;div id=”listItem1” lang=”ja”&gt;&lt;/div&gt;</p>
<p>&lt;div id=”listItem2” lang=”ko”&gt;&lt;/div&gt;</p>
<p>省略</p>
<p>&lt;/html&gt;</p></td>
</tr>
</tbody>
</table>

**lang属性値と適用される表示言語・フォントファミリーの対応**

<table>
<thead>
<tr class="header">
<th><strong>lang属性値</strong></th>
<th><strong>表示言語</strong></th>
<th><strong>フォントファミリー</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ja</td>
<td>日本語</td>
<td>HeiseiMaruGoth_JIS0213C</td>
</tr>
<tr class="even">
<td>zh-CN</td>
<td>簡体字中国語</td>
<td>MYuenC-SemiBold-Big5HKSCS</td>
</tr>
<tr class="odd">
<td>zh-TW</td>
<td>繁体字中国語</td>
<td>MYuenSemiBd18030C</td>
</tr>
<tr class="even">
<td>ko</td>
<td>韓国語</td>
<td>HangulRdGothMed5601C</td>
</tr>
<tr class="odd">
<td>その他</td>
<td>その他言語</td>
<td>Neue Frutiger World</td>
</tr>
</tbody>
</table>

### 　3.3.6. アイコンイメージに対する共通処理

CSCWidgetは、適宜以下の定義を利用してアイコンイメージに対する共通処理を指定する。

CSCWidgetを利用するアプリケーション内では、Widget以外の部品を配置する場合もこの定義を利用できる。

適用方法：

&lt;div&gt;タグに対するクラス属性として、所定の定義を指定する。

アイコンイメージのパスを、該&lt;div&gt;に適用するcssのbackground-image属性の値として設定する。

<span class="underline">cscw-imageおよびcscw-appIcon</span>

> \[5inch\]
>
> 領域サイズ（領域サイズを考慮したアイコンイメージが設定されている場合は、width,heightともにアイコンイメージの幅/高さより2px大きい値）を、該&lt;div&gt;に適用するcssのheightおよびwidth属性の値として設定する。
>
> \[10inch\]
>
> 領域サイズ（領域サイズを考慮したアイコンイメージが設定されている場合は、width,heightともにアイコンイメージの幅/高さと同じ値）を、該&lt;div&gt;に適用するcssのheightおよびwidth属性の値として設定する。

<span
class="underline">cscw-optimizedImageおよびcscw-optimizedAppIcon</span>

> 領域サイズ（領域サイズを考慮したアイコンイメージが設定されている場合は、width,heightともにアイコンイメージの幅/高さと同じ値）を、該&lt;div&gt;に適用するcssのheightおよびwidth属性の値として設定する。

**アイコンイメージに対する共通処理指定**

<table>
<thead>
<tr class="header">
<th><strong>定義</strong></th>
<th><strong>意味</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>.cscw-image</td>
<td>以下に図示する、一般アイコン仕様に従って、アイコンイメージの周囲に白枠を描画する。</td>
</tr>
<tr class="even">
<td>.cscw-appIcon</td>
<td>以下に図示する、AppIcon仕様に従って、アイコンイメージの周囲に白枠を描画する。</td>
</tr>
<tr class="odd">
<td>.cscw-optimizedImage</td>
<td>cssによる付随的な描画は行わない。</td>
</tr>
<tr class="even">
<td>.cscw-optimizedAppIcon</td>
<td>cssによる付随的な描画は行わない。</td>
</tr>
</tbody>
</table>

> **一般アイコンイメージ、およびAppIconに適用されるスタイル(5inch)**
>
> **一般アイコンイメージ、およびAppIconに適用されるスタイル(10inch)**
>
> **アイコンイメージに適用されるスタイル（上段：5inch/下段：10inch）**

<table>
<thead>
<tr class="header">
<th></th>
<th>border-radius</th>
<th>border</th>
<th>box-shadow</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>cscw-image,</p>
<p>cscw-appIcon</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>なし</td>
<td></td>
</tr>
<tr class="odd">
<td>cscw-optimizedImage</td>
<td>なし</td>
<td>なし</td>
<td>なし</td>
</tr>
</tbody>
</table>

　領域サイズとアイコンイメージのサイズが合わない場合、領域内でイメージは以下のように配置される。

・リピートなし

・領域内中央に表示

・画像欠け、縦横比の変更なしに、領域内にぴったりと収まるサイズに拡大もしくは縮小

###  3.3.7. テーマカラーにより定義された色彩の利用

CSCWidgetを利用するアプリケーション内では、Widget以外の部品を作成する際に、テーマカラーにより定義された色彩として以下を利用することができる。

適用方法：

&lt;div&gt;タグに対するクラス属性として指定する。

**テーマカラーにより定義された色彩の適用**

<table>
<thead>
<tr class="header">
<th><strong>定義</strong></th>
<th><strong>意味</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>.cscw-colorElement</td>
<td>テーマカラーに沿った背景画像（テクスチャ）と、この上に描画されるテキストに対して適用されるべきフォントカラーが適用される。</td>
</tr>
<tr class="even">
<td>.cscw-colorElement-shade-border</td>
<td>“shade color”として定義された色を、border色として適用する。</td>
</tr>
<tr class="odd">
<td>.cscw-colorElement-shade-background</td>
<td>“shade color”として定義された色を、背景色として適用する</td>
</tr>
<tr class="even">
<td>.cscw-colorElement-tint-border</td>
<td>“tint color”として定義された色を、border色として適用する。</td>
</tr>
<tr class="odd">
<td>.cscw-colorElement-tint-background</td>
<td>“tint color”として定義された色を、背景色として適用する</td>
</tr>
</tbody>
</table>

### 3.3.8. その他の規定情報の利用

CSCWidgetを利用するアプリケーション内では、Widget以外の部品を作成する際に、以下を規定済みクラスとして利用することができる。

適用方法：

&lt;div&gt;タグに対するクラス属性として指定する。

**その他の規定済みクラス**

<table>
<thead>
<tr class="header">
<th><strong>定義</strong></th>
<th><strong>意味</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>.cscw-common-disable</td>
<td>Opacity:が適用される。</td>
</tr>
<tr class="even">
<td>.cscw-common-padding</td>
<td>標準のpadding が 上下左右に適用される。</td>
</tr>
<tr class="odd">
<td>.cscw-common-padding-top</td>
<td>標準のpadding が上に適用される。</td>
</tr>
<tr class="even">
<td>.cscw-common-padding-bottom</td>
<td>標準のpadding が下に適用される。</td>
</tr>
<tr class="odd">
<td>.cscw-common-padding-left</td>
<td>標準のpadding が左に適用される。</td>
</tr>
<tr class="even">
<td>.cscw-common-padding-right</td>
<td>標準のpadding が右に適用される。</td>
</tr>
<tr class="odd">
<td>.cscw-baseLayer</td>
<td>最下層のlayerであることを示すクラスが適用される。</td>
</tr>
<tr class="even">
<td>.cscw-paperMimic-shadow</td>
<td>用紙を示すMimic用のシャドウが適用される。</td>
</tr>
<tr class="odd">
<td>cscw-fullSize</td>
<td>親要素のpaddingを無視して、親要素のborderの内側一杯に要素を配置する</td>
</tr>
</tbody>
</table>

3.4. JavaScript
----------

全てのWidgetはjQuery のプラグイン形式で提供する。

jQueryプラグイン作成の仕組みとしてCSCWidget Factoryを利用する。

### 3.4.1. 名前空間

Widgetで利用するJavaScriptクラス名は、名前空間として$.**cscw**を用いる。名前空間は、CSCWidget
Factoryを使用してWidgetを作成することで自動的に付与される。

3.5. Markup
------

HTML上にマークアップしたタグを用いて、コンストラクタメソッドをコールすることで、Widgetを生成することができる。マークアップに使用できるタグはWidgetごとに定められる。記載していないタグを使用した場合の動作はサポートしない。

マークアップはHTMLに静的に書かれている必要は無く、コンストラクタメソッドの実行時にDOMツリー上に構築されていればよい。

3.6. DOM
---

Widgetは、表示制御のために、DOMツリーの構造を変更する。必要に応じてノードの追加・削除・移動を行う。

### 　3.6.1. ノードの探索

アプリケーションがノードの探索を行うとき、ツリーの階層情報を頼りに特定を行おうすると、WidgetによりDOMツリーの構造が変更されている為、意図した場所にノードが無くノードが取得できない、といった問題が生じる。よって、ノードの探索時は、ツリーの階層情報に依存した方法ではなく、要素に直接アクセス可能なようにIDやクラス名を定義し、ノードの特定に使用することが望ましい。
